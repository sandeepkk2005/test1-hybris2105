{"code":"import { __decorate, __extends, __metadata, __param } from \"tslib\";\r\n/*\r\n * Copyright (c) 2021 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { Inject } from '@angular/core';\r\nimport * as lo from 'lodash';\r\nimport { CrossFrameEventService, DRAG_AND_DROP_CROSS_ORIGIN_BEFORE_TIME, IDragAndDropCrossOrigin, SeDowngradeService, SEND_MOUSE_POSITION_THROTTLE, SMARTEDIT_DRAG_AND_DROP_EVENTS, SMARTEDIT_IFRAME_DRAG_AREA, YJQUERY_TOKEN } from 'smarteditcommons';\r\nimport { IframeManagerService } from './iframe/IframeManagerService';\r\n/**\r\n * Polyfill for HTML5 Drag and Drop in a cross-origin setup.\r\n * Most browsers (except Firefox) do not allow on-page drag-and-drop from non-same-origin frames.\r\n * This service is a polyfill to allow it, by listening the 'dragover' event over a sibling <div> of the iframe and sending the mouse position to the inner frame.\r\n * The inner frame 'DragAndDropCrossOriginInner' will use document.elementFromPoint (or isPointOverElement helper function for IE only) to determine the current hovered element and then dispatch drag events onto elligible droppable elements.\r\n *\r\n * More information about security restrictions:\r\n * https://bugs.chromium.org/p/chromium/issues/detail?id=251718\r\n * https://bugs.chromium.org/p/chromium/issues/detail?id=59081\r\n * https://www.infosecurity-magazine.com/news/new-google-chrome-clickjacking-vulnerability/\r\n * https://bugzilla.mozilla.org/show_bug.cgi?id=605991\r\n */\r\n/** @internal */\r\nvar /* @ngInject */ DragAndDropCrossOrigin = /** @class */ (function (_super) {\r\n    __extends(/* @ngInject */ DragAndDropCrossOrigin, _super);\r\n    function /* @ngInject */ DragAndDropCrossOrigin(yjQuery, crossFrameEventService, iframeManagerService) {\r\n        var _this = _super.call(this) || this;\r\n        _this.yjQuery = yjQuery;\r\n        _this.crossFrameEventService = crossFrameEventService;\r\n        _this.iframeManagerService = iframeManagerService;\r\n        _this.onDragStart = function () {\r\n            if (!_this.isEnabled()) {\r\n                return;\r\n            }\r\n            _this.crossFrameEventService.publish(SMARTEDIT_DRAG_AND_DROP_EVENTS.DRAG_DROP_CROSS_ORIGIN_START);\r\n            _this.syncIframeDragArea()\r\n                .show()\r\n                .off('dragover') // `off()` is necessary since dragEnd event is not always fired.\r\n                .on('dragover', function (e) {\r\n                e.preventDefault(); // `preventDefault()` is necessary for the 'drop' event callback to be fired.\r\n                var mousePosition = _this.getPositionRelativeToIframe(e.pageX, e.pageY);\r\n                _this.throttledSendMousePosition(mousePosition);\r\n                return false;\r\n            })\r\n                .off('drop')\r\n                .on('drop', function (e) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                var mousePosition = _this.getPositionRelativeToIframe(e.pageX, e.pageY);\r\n                _this.crossFrameEventService.publish(SMARTEDIT_DRAG_AND_DROP_EVENTS.DROP_ELEMENT, mousePosition);\r\n                return false;\r\n            });\r\n        };\r\n        _this.onDragEnd = function () {\r\n            if (!_this.isEnabled()) {\r\n                return;\r\n            }\r\n            _this.getIframeDragArea().off('dragover').off('drop').hide();\r\n        };\r\n        _this.sendMousePosition = function (mousePosition) {\r\n            _this.crossFrameEventService.publish(SMARTEDIT_DRAG_AND_DROP_EVENTS.TRACK_MOUSE_POSITION, mousePosition);\r\n        };\r\n        return _this;\r\n    }\r\n    /* @ngInject */ DragAndDropCrossOrigin.prototype.initialize = function () {\r\n        var _this = this;\r\n        this.throttledSendMousePosition = lo.throttle(this.sendMousePosition, SEND_MOUSE_POSITION_THROTTLE);\r\n        this.crossFrameEventService.subscribe(SMARTEDIT_DRAG_AND_DROP_EVENTS.DRAG_DROP_START, this.onDragStart);\r\n        this.crossFrameEventService.subscribe(SMARTEDIT_DRAG_AND_DROP_EVENTS.DRAG_DROP_END, this.onDragEnd);\r\n        this.crossFrameEventService.subscribe(DRAG_AND_DROP_CROSS_ORIGIN_BEFORE_TIME.START, function () {\r\n            if (_this.isEnabled()) {\r\n                _this.iframeManagerService.getIframe().css('pointer-events', 'none');\r\n            }\r\n        });\r\n        this.crossFrameEventService.subscribe(DRAG_AND_DROP_CROSS_ORIGIN_BEFORE_TIME.END, function () {\r\n            if (_this.isEnabled()) {\r\n                _this.iframeManagerService.getIframe().css('pointer-events', 'auto');\r\n            }\r\n        });\r\n    };\r\n    /* @ngInject */ DragAndDropCrossOrigin.prototype.isEnabled = function () {\r\n        return this.iframeManagerService.isCrossOrigin();\r\n    };\r\n    /* @ngInject */ DragAndDropCrossOrigin.prototype.getIframeDragArea = function () {\r\n        return this.yjQuery('#' + SMARTEDIT_IFRAME_DRAG_AREA);\r\n    };\r\n    /* @ngInject */ DragAndDropCrossOrigin.prototype.getPositionRelativeToIframe = function (posX, posY) {\r\n        var iframeOffset = this.getIframeDragArea().offset();\r\n        return {\r\n            x: posX - iframeOffset.left,\r\n            y: posY - iframeOffset.top\r\n        };\r\n    };\r\n    /* @ngInject */ DragAndDropCrossOrigin.prototype.syncIframeDragArea = function () {\r\n        this.getIframeDragArea().width(this.iframeManagerService.getIframe().width());\r\n        this.getIframeDragArea().height(this.iframeManagerService.getIframe().height());\r\n        var iframeOffset = this.iframeManagerService.getIframe().offset();\r\n        this.getIframeDragArea().css({\r\n            top: iframeOffset.top,\r\n            left: iframeOffset.left\r\n        });\r\n        return this.getIframeDragArea();\r\n    };\r\n    /* @ngInject */ DragAndDropCrossOrigin = __decorate([\r\n        SeDowngradeService(IDragAndDropCrossOrigin),\r\n        __param(0, Inject(YJQUERY_TOKEN)),\r\n        __metadata(\"design:paramtypes\", [Function, CrossFrameEventService,\r\n            IframeManagerService])\r\n    ], /* @ngInject */ DragAndDropCrossOrigin);\r\n    return /* @ngInject */ DragAndDropCrossOrigin;\r\n}(IDragAndDropCrossOrigin));\r\nexport { /* @ngInject */ DragAndDropCrossOrigin };\r\n//# sourceMappingURL=DragAndDropCrossOriginOuter.js.map","references":["/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular/core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@types/lodash@4.14.159/node_modules/@types/lodash/ts3.1/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-container/src/services/iframe/IframeManagerService.ts"],"map":"{\"version\":3,\"file\":\"DragAndDropCrossOriginOuter.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/services/DragAndDropCrossOriginOuter.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-container/services/DragAndDropCrossOriginOuter.d.ts","writeByteOrderMark":false,"text":"/// <reference types=\"angular\" />\r\n/// <reference types=\"jquery\" />\r\nimport { CrossFrameEventService, IDragAndDropCrossOrigin } from 'smarteditcommons';\r\nimport { IframeManagerService } from './iframe/IframeManagerService';\r\n/**\r\n * Polyfill for HTML5 Drag and Drop in a cross-origin setup.\r\n * Most browsers (except Firefox) do not allow on-page drag-and-drop from non-same-origin frames.\r\n * This service is a polyfill to allow it, by listening the 'dragover' event over a sibling <div> of the iframe and sending the mouse position to the inner frame.\r\n * The inner frame 'DragAndDropCrossOriginInner' will use document.elementFromPoint (or isPointOverElement helper function for IE only) to determine the current hovered element and then dispatch drag events onto elligible droppable elements.\r\n *\r\n * More information about security restrictions:\r\n * https://bugs.chromium.org/p/chromium/issues/detail?id=251718\r\n * https://bugs.chromium.org/p/chromium/issues/detail?id=59081\r\n * https://www.infosecurity-magazine.com/news/new-google-chrome-clickjacking-vulnerability/\r\n * https://bugzilla.mozilla.org/show_bug.cgi?id=605991\r\n */\r\n/** @internal */\r\nexport declare class DragAndDropCrossOrigin extends IDragAndDropCrossOrigin {\r\n    private yjQuery;\r\n    private crossFrameEventService;\r\n    private iframeManagerService;\r\n    private throttledSendMousePosition;\r\n    constructor(yjQuery: JQueryStatic, crossFrameEventService: CrossFrameEventService, iframeManagerService: IframeManagerService);\r\n    initialize(): void;\r\n    private isEnabled;\r\n    private onDragStart;\r\n    private onDragEnd;\r\n    private sendMousePosition;\r\n    private getIframeDragArea;\r\n    private getPositionRelativeToIframe;\r\n    private syncIframeDragArea;\r\n}\r\n"}}
