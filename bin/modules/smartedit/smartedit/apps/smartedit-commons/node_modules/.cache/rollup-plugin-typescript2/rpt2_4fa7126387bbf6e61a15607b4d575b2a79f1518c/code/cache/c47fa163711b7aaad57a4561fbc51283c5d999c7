{"code":"import { EVENTS } from '../../utils/smarteditconstants';\r\n/** @ignore */\r\nvar HasOperationPermissionBaseDirective = /** @class */ (function () {\r\n    function HasOperationPermissionBaseDirective(systemEventService, permissionService, logService) {\r\n        this.systemEventService = systemEventService;\r\n        this.permissionService = permissionService;\r\n        this.logService = logService;\r\n    }\r\n    HasOperationPermissionBaseDirective.prototype.ngOnInit = function () {\r\n        // NOTE: Refreshing permission checking should only be done after permissions have been cleaned\r\n        // (PERMISSION_CACHE_CLEANED). If this is done as soon after user is changed (USER_CHANGED) then there's a race\r\n        // condition between when the cache is cleaned and when this permission checking is executed.\r\n        this.unregisterHandler = this.systemEventService.subscribe(EVENTS.PERMISSION_CACHE_CLEANED, this.refreshIsPermissionGranted.bind(this));\r\n    };\r\n    HasOperationPermissionBaseDirective.prototype.ngOnDestroy = function () {\r\n        this.unregisterHandler();\r\n    };\r\n    HasOperationPermissionBaseDirective.prototype.ngOnChanges = function (changes) {\r\n        if (changes.hasOperationPermission && changes.hasOperationPermission.currentValue) {\r\n            this.permission = changes.hasOperationPermission.currentValue;\r\n            this.refreshIsPermissionGranted();\r\n        }\r\n    };\r\n    Object.defineProperty(HasOperationPermissionBaseDirective.prototype, \"isPermissionGrantedHandler\", {\r\n        set: function (handler) {\r\n            this._isPermissionGrantedHandler = handler;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    HasOperationPermissionBaseDirective.prototype.refreshIsPermissionGranted = function () {\r\n        var _this = this;\r\n        this.isPermissionGranted(this.permission).then(function (isPermissionGranted) {\r\n            _this._isPermissionGrantedHandler(isPermissionGranted);\r\n        });\r\n    };\r\n    HasOperationPermissionBaseDirective.prototype.isPermissionGranted = function (permission) {\r\n        var _this = this;\r\n        return this.permissionService\r\n            .isPermitted(this.validateAndPreparePermissions(permission))\r\n            .then(function (isPermissionGranted) { return isPermissionGranted; }, function (error) {\r\n            _this.logService.error('Failed to retrieve authorization', error);\r\n            return false;\r\n        })\r\n            .then(function (isPermissionGranted) { return isPermissionGranted; });\r\n    };\r\n    HasOperationPermissionBaseDirective.prototype.validateAndPreparePermissions = function (permissions) {\r\n        if (typeof permissions !== 'string' && !Array.isArray(permissions)) {\r\n            throw new Error('Permission should be string or an array of objects');\r\n        }\r\n        return typeof permissions === 'string' ? this.toPermissions(permissions) : permissions;\r\n    };\r\n    HasOperationPermissionBaseDirective.prototype.toPermissions = function (permissions) {\r\n        return [{ names: permissions.split(',') }];\r\n    };\r\n    return HasOperationPermissionBaseDirective;\r\n}());\r\nexport { HasOperationPermissionBaseDirective };\r\n//# sourceMappingURL=HasOperationPermissionBaseDirective.js.map","references":["/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular/core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/services/index.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/utils/smarteditconstants.ts"],"map":"{\"version\":3,\"file\":\"HasOperationPermissionBaseDirective.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/directives/hasOperationPermission/HasOperationPermissionBaseDirective.ts\"],\"names\":[],\"mappings\":\"AAWA,OAAO,EAAE,MAAM,EAAE,MAAM,gCAAgC,CAAC;AAKxD,cAAc;AACd;IAKI,6CACY,kBAAsC,EACtC,iBAAqC,EACrC,UAAsB;QAFtB,uBAAkB,GAAlB,kBAAkB,CAAoB;QACtC,sBAAiB,GAAjB,iBAAiB,CAAoB;QACrC,eAAU,GAAV,UAAU,CAAY;IAC/B,CAAC;IAEJ,sDAAQ,GAAR;QACI,+FAA+F;QAC/F,+GAA+G;QAC/G,6FAA6F;QAC7F,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,kBAAkB,CAAC,SAAS,CACtD,MAAM,CAAC,wBAAwB,EAC/B,IAAI,CAAC,0BAA0B,CAAC,IAAI,CAAC,IAAI,CAAC,CAC7C,CAAC;IACN,CAAC;IAED,yDAAW,GAAX;QACI,IAAI,CAAC,iBAAiB,EAAE,CAAC;IAC7B,CAAC;IAED,yDAAW,GAAX,UAAY,OAAsB;QAC9B,IAAI,OAAO,CAAC,sBAAsB,IAAI,OAAO,CAAC,sBAAsB,CAAC,YAAY,EAAE;YAC/E,IAAI,CAAC,UAAU,GAAG,OAAO,CAAC,sBAAsB,CAAC,YAAY,CAAC;YAC9D,IAAI,CAAC,0BAA0B,EAAE,CAAC;SACrC;IACL,CAAC;IAED,sBAAc,2EAA0B;aAAxC,UAAyC,OAAmC;YACxE,IAAI,CAAC,2BAA2B,GAAG,OAAO,CAAC;QAC/C,CAAC;;;OAAA;IAEO,wEAA0B,GAAlC;QAAA,iBAIC;QAHG,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,UAAC,mBAAmB;YAC/D,KAAI,CAAC,2BAA2B,CAAC,mBAAmB,CAAC,CAAC;QAC1D,CAAC,CAAC,CAAC;IACP,CAAC;IAEO,iEAAmB,GAA3B,UACI,UAAiD;QADrD,iBAaC;QAVG,OAAO,IAAI,CAAC,iBAAiB;aACxB,WAAW,CAAC,IAAI,CAAC,6BAA6B,CAAC,UAAU,CAAC,CAAC;aAC3D,IAAI,CACD,UAAC,mBAA4B,IAAK,OAAA,mBAAmB,EAAnB,CAAmB,EACrD,UAAC,KAAK;YACF,KAAI,CAAC,UAAU,CAAC,KAAK,CAAC,kCAAkC,EAAE,KAAK,CAAC,CAAC;YACjE,OAAO,KAAK,CAAC;QACjB,CAAC,CACJ;aACA,IAAI,CAAC,UAAC,mBAA4B,IAAK,OAAA,mBAAmB,EAAnB,CAAmB,CAAC,CAAC;IACrE,CAAC;IAEO,2EAA6B,GAArC,UACI,WAAkD;QAElD,IAAI,OAAO,WAAW,KAAK,QAAQ,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,WAAW,CAAC,EAAE;YAChE,MAAM,IAAI,KAAK,CAAC,oDAAoD,CAAC,CAAC;SACzE;QAED,OAAO,OAAO,WAAW,KAAK,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC;IAC3F,CAAC;IAEO,2DAAa,GAArB,UAAsB,WAAmB;QACrC,OAAO,CAAC,EAAE,KAAK,EAAE,WAAW,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;IAC/C,CAAC;IACL,0CAAC;AAAD,CAAC,AAtED,IAsEC\"}","dts":{"name":"/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/directives/hasOperationPermission/HasOperationPermissionBaseDirective.d.ts","writeByteOrderMark":false,"text":"import { OnChanges, OnDestroy, OnInit, SimpleChanges } from '@angular/core';\r\nimport { IPermissionService, LogService, SystemEventService } from '../../services';\r\n/** @ignore */\r\nexport declare type IsPermissionGrantedHandler = (isPermissionGranted: boolean) => void;\r\n/** @ignore */\r\nexport declare abstract class HasOperationPermissionBaseDirective implements OnInit, OnDestroy, OnChanges {\r\n    private systemEventService;\r\n    private permissionService;\r\n    private logService;\r\n    private _isPermissionGrantedHandler;\r\n    private unregisterHandler;\r\n    private permission;\r\n    constructor(systemEventService: SystemEventService, permissionService: IPermissionService, logService: LogService);\r\n    ngOnInit(): void;\r\n    ngOnDestroy(): void;\r\n    ngOnChanges(changes: SimpleChanges): void;\r\n    protected set isPermissionGrantedHandler(handler: IsPermissionGrantedHandler);\r\n    private refreshIsPermissionGranted;\r\n    private isPermissionGranted;\r\n    private validateAndPreparePermissions;\r\n    private toPermissions;\r\n}\r\n"}}
