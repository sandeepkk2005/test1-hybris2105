{"code":"import { __decorate, __metadata } from \"tslib\";\r\n/*\r\n * Copyright (c) 2021 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { FunctionsUtils, LogService, PromiseUtils, StringUtils } from '@smart/utils';\r\nimport { SeDowngradeService } from 'smarteditcommons/di';\r\nimport { GatewayFactory } from './GatewayFactory';\r\n/**\r\n * To seamlessly integrate the gateway factory between two services on different frames, you can use a gateway\r\n * proxy. The gateway proxy service simplifies using the gateway module by providing an API that registers an\r\n * instance of a service that requires a gateway for communication.\r\n *\r\n * This registration process automatically attaches listeners to each of the service's functions (turned into promises), allowing stub\r\n * instances to forward calls to these functions using an instance of a gateway from {@link GatewayFactory}.\r\n * Any function that has an empty body declared on the service is used as a proxy function.\r\n * It delegates a publish call to the gateway under the same function name, and wraps the result of the call in a Promise.\r\n */\r\nvar /* @ngInject */ GatewayProxy = /** @class */ (function () {\r\n    function /* @ngInject */ GatewayProxy(logService, promiseUtils, stringUtils, functionsUtils, gatewayFactory) {\r\n        this.logService = logService;\r\n        this.promiseUtils = promiseUtils;\r\n        this.stringUtils = stringUtils;\r\n        this.functionsUtils = functionsUtils;\r\n        this.gatewayFactory = gatewayFactory;\r\n        this.nonProxiableMethods = [\r\n            'getMethodForVoid',\r\n            'getMethodForSingleInstance',\r\n            'getMethodForArray'\r\n        ];\r\n    }\r\n    /**\r\n     * Mutates the given service into a proxied service.\r\n     * You must provide a unique string gatewayId, in one of 2 ways.\r\n     *\r\n     *\r\n     * 1) Having a gatewayId property on the service provided\r\n     *\r\n     *\r\n     * OR\r\n     *\r\n     *\r\n     * 2) providing a gatewayId as 3rd param of this function\r\n     *\r\n     * @param service Service to mutate into a proxied service.\r\n     * @param methodsSubset An explicit set of methods on which the gatewayProxy will trigger. Otherwise, by default all functions will be proxied. This is particularly useful to avoid inner methods being unnecessarily turned into promises.\r\n     * @param gatewayId The gateway ID to use internaly for the proxy. If not provided, the service <strong>must</strong> have a gatewayId property.\r\n     */\r\n    /* @ngInject */ GatewayProxy.prototype.initForService = function (service, methodsSubset, gatewayId) {\r\n        var _this = this;\r\n        var gwId = gatewayId || service.gatewayId;\r\n        if (!gwId) {\r\n            this.logService.error(\"initForService() - service expected to have an associated gatewayId - methodsSubset: \" + (methodsSubset && methodsSubset.length ? methodsSubset.join(',') : []));\r\n            return null;\r\n        }\r\n        var gateway = this.gatewayFactory.createGateway(gwId);\r\n        var loopedOver = methodsSubset;\r\n        if (!loopedOver) {\r\n            loopedOver = [];\r\n            for (var key in service) {\r\n                if (typeof service[key] === 'function' && !this._isNonProxiableMethod(key)) {\r\n                    loopedOver.push(key);\r\n                }\r\n            }\r\n        }\r\n        loopedOver.forEach(function (fnName) {\r\n            if (typeof service[fnName] === 'function') {\r\n                if (_this.functionsUtils.isEmpty(service[fnName])) {\r\n                    _this._turnToProxy(fnName, service, gateway);\r\n                }\r\n                else {\r\n                    service[fnName] = _this.promiseUtils.toPromise(service[fnName], service);\r\n                    gateway.subscribe(fnName, _this._onGatewayEvent.bind(null, fnName, service));\r\n                }\r\n            }\r\n        });\r\n    };\r\n    /** @ignore */\r\n    /* @ngInject */ GatewayProxy.prototype._isNonProxiableMethod = function (key) {\r\n        return (this.nonProxiableMethods.indexOf(key) > -1 ||\r\n            key.startsWith('$') ||\r\n            key === 'lodash' ||\r\n            key === 'jQuery');\r\n    };\r\n    /** @ignore */\r\n    /* @ngInject */ GatewayProxy.prototype._onGatewayEvent = function (fnName, service, eventId, data) {\r\n        return service[fnName].apply(service, data.arguments);\r\n    };\r\n    /** @ignore */\r\n    /* @ngInject */ GatewayProxy.prototype._turnToProxy = function (fnName, service, gateway) {\r\n        var _this = this;\r\n        delete service[fnName];\r\n        service[fnName] = (function () {\r\n            var args = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                args[_i] = arguments[_i];\r\n            }\r\n            return gateway\r\n                .publish(fnName, {\r\n                arguments: args\r\n            })\r\n                .then(function (resolvedData) {\r\n                if (!_this.stringUtils.isBlank(resolvedData)) {\r\n                    delete resolvedData.$resolved;\r\n                    delete resolvedData.$promise;\r\n                }\r\n                return resolvedData;\r\n            }, function (error) {\r\n                if (error) {\r\n                    _this.logService.debug(\"gatewayProxy - publish failed for gateway \" + gateway.gatewayId + \" method \" + fnName + \" and arguments \" + args);\r\n                }\r\n                return Promise.reject(error);\r\n            });\r\n        });\r\n    };\r\n    /* @ngInject */ GatewayProxy = __decorate([\r\n        SeDowngradeService(),\r\n        __metadata(\"design:paramtypes\", [LogService,\r\n            PromiseUtils,\r\n            StringUtils,\r\n            FunctionsUtils,\r\n            GatewayFactory])\r\n    ], /* @ngInject */ GatewayProxy);\r\n    return /* @ngInject */ GatewayProxy;\r\n}());\r\nexport { /* @ngInject */ GatewayProxy };\r\n//# sourceMappingURL=GatewayProxy.js.map","references":["/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/dist/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/di/index.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/services/gateway/GatewayFactory.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/services/gateway/IProxiedService.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/services/gateway/MessageGateway.ts"],"map":"{\"version\":3,\"file\":\"GatewayProxy.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/services/gateway/GatewayProxy.ts\"],\"names\":[],\"mappings\":\";AAAA;;GAEG;AACH,OAAO,EAAa,cAAc,EAAE,UAAU,EAAE,YAAY,EAAE,WAAW,EAAE,MAAM,cAAc,CAAC;AAChG,OAAO,EAAE,kBAAkB,EAAE,MAAM,qBAAqB,CAAC;AACzD,OAAO,EAAE,cAAc,EAAE,MAAM,kBAAkB,CAAC;AAIlD;;;;;;;;;GASG;AAEH;IAOI,sCACY,UAAsB,EACtB,YAA0B,EAC1B,WAAwB,EACxB,cAA8B,EAC9B,cAA8B;QAJ9B,eAAU,GAAV,UAAU,CAAY;QACtB,iBAAY,GAAZ,YAAY,CAAc;QAC1B,gBAAW,GAAX,WAAW,CAAa;QACxB,mBAAc,GAAd,cAAc,CAAgB;QAC9B,mBAAc,GAAd,cAAc,CAAgB;QAXlC,wBAAmB,GAAG;YAC1B,kBAAkB;YAClB,4BAA4B;YAC5B,mBAAmB;SACtB,CAAC;IAQC,CAAC;IAEJ;;;;;;;;;;;;;;;;OAgBG;IACH,qDAAc,GAAd,UACI,OAAU,EACV,aAAwB,EACxB,SAAkB;QAHtB,iBAsCC;QAjCG,IAAM,IAAI,GAAG,SAAS,IAAI,OAAO,CAAC,SAAS,CAAC;QAE5C,IAAI,CAAC,IAAI,EAAE;YACP,IAAI,CAAC,UAAU,CAAC,KAAK,CACjB,2FACI,aAAa,IAAI,aAAa,CAAC,MAAM,CAAC,CAAC,CAAC,aAAa,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CACtE,CACL,CAAC;YACF,OAAO,IAAI,CAAC;SACf;QAED,IAAM,OAAO,GAAmB,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;QAExE,IAAI,UAAU,GAAG,aAAa,CAAC;QAC/B,IAAI,CAAC,UAAU,EAAE;YACb,UAAU,GAAG,EAAE,CAAC;YAChB,KAAK,IAAM,GAAG,IAAI,OAAO,EAAE;gBACvB,IAAI,OAAO,OAAO,CAAC,GAAG,CAAC,KAAK,UAAU,IAAI,CAAC,IAAI,CAAC,qBAAqB,CAAC,GAAG,CAAC,EAAE;oBACxE,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;iBACxB;aACJ;SACJ;QAED,UAAU,CAAC,OAAO,CAAC,UAAC,MAAgC;YAChD,IAAI,OAAO,OAAO,CAAC,MAAM,CAAC,KAAK,UAAU,EAAE;gBACvC,IAAI,KAAI,CAAC,cAAc,CAAC,OAAO,CAAC,OAAO,CAAC,MAAM,CAAQ,CAAC,EAAE;oBACrD,KAAI,CAAC,YAAY,CAAC,MAAM,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC;iBAC/C;qBAAM;oBACH,OAAO,CAAC,MAAM,CAAC,GAAG,KAAI,CAAC,YAAY,CAAC,SAAS,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,OAAO,CAAQ,CAAC;oBAC/E,OAAO,CAAC,SAAS,CAAC,MAAM,EAAE,KAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,EAAE,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC;iBAC/E;aACJ;QACL,CAAC,CAAC,CAAC;IACP,CAAC;IAED,cAAc;IACN,4DAAqB,GAA7B,UAA8B,GAAW;QACrC,OAAO,CACH,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YAC1C,GAAG,CAAC,UAAU,CAAC,GAAG,CAAC;YACnB,GAAG,KAAK,QAAQ;YAChB,GAAG,KAAK,QAAQ,CACnB,CAAC;IACN,CAAC;IAED,cAAc;IACN,sDAAe,GAAvB,UACI,MAAgC,EAChC,OAAU,EACV,OAAe,EACf,IAA8B;QAE9B,OAAQ,OAAO,CAAC,MAAM,CAAS,CAAC,KAAK,CAAC,OAAO,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;IACnE,CAAC;IAED,cAAc;IACN,mDAAY,GAApB,UACI,MAAgC,EAChC,OAAU,EACV,OAAuB;QAH3B,iBA6BC;QAxBG,OAAO,OAAO,CAAC,MAAM,CAAC,CAAC;QAEvB,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC;YAAC,cAAoB;iBAApB,UAAoB,EAApB,qBAAoB,EAApB,IAAoB;gBAApB,yBAAoB;;YACpC,OAAA,OAAO;iBACF,OAAO,CAAC,MAAM,EAAE;gBACb,SAAS,EAAE,IAAI;aACL,CAAC;iBACd,IAAI,CACD,UAAC,YAAuB;gBACpB,IAAI,CAAC,KAAI,CAAC,WAAW,CAAC,OAAO,CAAC,YAAY,CAAC,EAAE;oBACzC,OAAQ,YAAoB,CAAC,SAAS,CAAC;oBACvC,OAAQ,YAAoB,CAAC,QAAQ,CAAC;iBACzC;gBACD,OAAO,YAAY,CAAC;YACxB,CAAC,EACD,UAAC,KAAU;gBACP,IAAI,KAAK,EAAE;oBACP,KAAI,CAAC,UAAU,CAAC,KAAK,CACjB,+CAA6C,OAAO,CAAC,SAAS,gBAAW,MAAM,uBAAkB,IAAM,CAC1G,CAAC;iBACL;gBACD,OAAO,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;YACjC,CAAC,CACJ;QApBL,CAoBK,CAAQ,CAAC;IACtB,CAAC;IA1HL;QADC,kBAAkB,EAAE;yCASO,UAAU;YACR,YAAY;YACb,WAAW;YACR,cAAc;YACd,cAAc;oCA+G7C;IAAD,mCAAC;CAAA,AA3HD,IA2HC\"}","dts":{"name":"/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/services/gateway/GatewayProxy.d.ts","writeByteOrderMark":false,"text":"import { FunctionsUtils, LogService, PromiseUtils, StringUtils } from '@smart/utils';\r\nimport { GatewayFactory } from './GatewayFactory';\r\nimport { IProxiedService } from './IProxiedService';\r\n/**\r\n * To seamlessly integrate the gateway factory between two services on different frames, you can use a gateway\r\n * proxy. The gateway proxy service simplifies using the gateway module by providing an API that registers an\r\n * instance of a service that requires a gateway for communication.\r\n *\r\n * This registration process automatically attaches listeners to each of the service's functions (turned into promises), allowing stub\r\n * instances to forward calls to these functions using an instance of a gateway from {@link GatewayFactory}.\r\n * Any function that has an empty body declared on the service is used as a proxy function.\r\n * It delegates a publish call to the gateway under the same function name, and wraps the result of the call in a Promise.\r\n */\r\nexport declare class GatewayProxy {\r\n    private logService;\r\n    private promiseUtils;\r\n    private stringUtils;\r\n    private functionsUtils;\r\n    private gatewayFactory;\r\n    private nonProxiableMethods;\r\n    constructor(logService: LogService, promiseUtils: PromiseUtils, stringUtils: StringUtils, functionsUtils: FunctionsUtils, gatewayFactory: GatewayFactory);\r\n    /**\r\n     * Mutates the given service into a proxied service.\r\n     * You must provide a unique string gatewayId, in one of 2 ways.\r\n     *\r\n     *\r\n     * 1) Having a gatewayId property on the service provided\r\n     *\r\n     *\r\n     * OR\r\n     *\r\n     *\r\n     * 2) providing a gatewayId as 3rd param of this function\r\n     *\r\n     * @param service Service to mutate into a proxied service.\r\n     * @param methodsSubset An explicit set of methods on which the gatewayProxy will trigger. Otherwise, by default all functions will be proxied. This is particularly useful to avoid inner methods being unnecessarily turned into promises.\r\n     * @param gatewayId The gateway ID to use internaly for the proxy. If not provided, the service <strong>must</strong> have a gatewayId property.\r\n     */\r\n    initForService<T extends IProxiedService>(service: T, methodsSubset?: string[], gatewayId?: string): void;\r\n    /** @ignore */\r\n    private _isNonProxiableMethod;\r\n    /** @ignore */\r\n    private _onGatewayEvent;\r\n    /** @ignore */\r\n    private _turnToProxy;\r\n}\r\n"}}
