{"code":"import { __awaiter, __decorate, __generator, __metadata } from \"tslib\";\r\n/*\r\n * Copyright (c) 2021 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { Injectable } from '@angular/core';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { CmsitemsRestService, IContextAwareEditableItemService, IPageService } from 'cmscommons';\r\nimport { ContextAwarePageStructureService } from '../../../services';\r\nvar /* @ngInject */ PageEditorModalConfigService = /** @class */ (function () {\r\n    function /* @ngInject */ PageEditorModalConfigService(cmsitemsRestService, pageService, contextAwarePageStructureService, contextAwareEditableItemService, translateService) {\r\n        this.cmsitemsRestService = cmsitemsRestService;\r\n        this.pageService = pageService;\r\n        this.contextAwarePageStructureService = contextAwarePageStructureService;\r\n        this.contextAwareEditableItemService = contextAwareEditableItemService;\r\n        this.translateService = translateService;\r\n    }\r\n    /** Creates a config for given Page that can be used to open a modal.  */\r\n    /* @ngInject */ PageEditorModalConfigService.prototype.create = function (page) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var config, _a, cmsPage, isPagePrimary, fields;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        config = {\r\n                            title: 'se.cms.pageeditormodal.editpagetab.title',\r\n                            componentUuid: page.uuid,\r\n                            componentType: page.typeCode\r\n                        };\r\n                        return [4 /*yield*/, Promise.all([\r\n                                this.cmsitemsRestService.getById(page.uuid),\r\n                                this.pageService.isPagePrimary(page.uid)\r\n                            ])];\r\n                    case 1:\r\n                        _a = _b.sent(), cmsPage = _a[0], isPagePrimary = _a[1];\r\n                        config.content = cmsPage;\r\n                        config.content.template = cmsPage.masterTemplateId;\r\n                        return [4 /*yield*/, this.contextAwarePageStructureService.getPageStructureForPageEditing(config.content.typeCode, config.content.uid)];\r\n                    case 2:\r\n                        fields = _b.sent();\r\n                        config.structure = fields;\r\n                        if (isPagePrimary) {\r\n                            config.structure.attributes = this.filterPrimaryPageAttributes(config.structure.attributes);\r\n                        }\r\n                        if (!!!page.uid) return [3 /*break*/, 4];\r\n                        return [4 /*yield*/, this.ensureReadOnlyMode(page, config)];\r\n                    case 3:\r\n                        _b.sent();\r\n                        _b.label = 4;\r\n                    case 4: return [2 /*return*/, config];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /* @ngInject */ PageEditorModalConfigService.prototype.filterPrimaryPageAttributes = function (attributes) {\r\n        var _this = this;\r\n        return attributes.filter(function (field) { return _this.isPrimaryPageAttribute(field); });\r\n    };\r\n    /* @ngInject */ PageEditorModalConfigService.prototype.isPrimaryPageAttribute = function (attribute) {\r\n        return (attribute.qualifier !== 'restrictions' &&\r\n            attribute.qualifier !== 'onlyOneRestrictionMustApply');\r\n    };\r\n    /* @ngInject */ PageEditorModalConfigService.prototype.ensureReadOnlyMode = function (page, config) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var isEditable;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.contextAwareEditableItemService.isItemEditable(page.uid)];\r\n                    case 1:\r\n                        isEditable = _a.sent();\r\n                        config.readOnlyMode = !isEditable;\r\n                        if (config.readOnlyMode) {\r\n                            config.messages = [\r\n                                {\r\n                                    type: 'info',\r\n                                    message: this.translateService.instant('se.cms.pageeditormodal.page.readonly.message')\r\n                                }\r\n                            ];\r\n                        }\r\n                        return [2 /*return*/, config];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /* @ngInject */ PageEditorModalConfigService = __decorate([\r\n        Injectable(),\r\n        __metadata(\"design:paramtypes\", [CmsitemsRestService,\r\n            IPageService,\r\n            ContextAwarePageStructureService,\r\n            IContextAwareEditableItemService,\r\n            TranslateService])\r\n    ], /* @ngInject */ PageEditorModalConfigService);\r\n    return /* @ngInject */ PageEditorModalConfigService;\r\n}());\r\nexport { /* @ngInject */ PageEditorModalConfigService };\r\n//# sourceMappingURL=PageEditorModalConfigService.js.map","references":["/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular/core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@ngx-translate/core@11.0.1_@angular+core@8.2.14+rxjs@6.5.4/node_modules/@ngx-translate/core/ngx-translate-core.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-commons/dist/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/services/index.ts"],"map":"{\"version\":3,\"file\":\"PageEditorModalConfigService.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/components/pages/services/PageEditorModalConfigService.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/components/pages/services/PageEditorModalConfigService.d.ts","writeByteOrderMark":false,"text":"import { TranslateService } from '@ngx-translate/core';\r\nimport { CmsitemsRestService, ICMSPage, IContextAwareEditableItemService, IGenericEditorModalServiceComponent, IPageService } from 'cmscommons';\r\nimport { ContextAwarePageStructureService } from '../../../services';\r\nexport declare class PageEditorModalConfigService {\r\n    private cmsitemsRestService;\r\n    private pageService;\r\n    private contextAwarePageStructureService;\r\n    private contextAwareEditableItemService;\r\n    private translateService;\r\n    constructor(cmsitemsRestService: CmsitemsRestService, pageService: IPageService, contextAwarePageStructureService: ContextAwarePageStructureService, contextAwareEditableItemService: IContextAwareEditableItemService, translateService: TranslateService);\r\n    /** Creates a config for given Page that can be used to open a modal.  */\r\n    create(page: ICMSPage): Promise<IGenericEditorModalServiceComponent>;\r\n    private filterPrimaryPageAttributes;\r\n    private isPrimaryPageAttribute;\r\n    private ensureReadOnlyMode;\r\n}\r\n"}}
