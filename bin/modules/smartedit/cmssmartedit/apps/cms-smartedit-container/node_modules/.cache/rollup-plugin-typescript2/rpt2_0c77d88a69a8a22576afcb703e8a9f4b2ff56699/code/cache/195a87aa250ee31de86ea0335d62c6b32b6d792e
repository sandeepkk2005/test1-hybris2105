{"code":"import { __awaiter, __decorate, __generator, __metadata } from \"tslib\";\r\n/*\r\n * Copyright (c) 2021 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { EVENT_CONTENT_CATALOG_UPDATE, IAlertService, IConfirmationModalService, IExperienceService, IPageInfoService, LogService, SeDowngradeService, SystemEventService } from 'smarteditcommons';\r\nimport { PageVersioningService } from './PageVersioningService';\r\nimport { PageVersionSelectionService } from './PageVersionSelectionService';\r\n/**\r\n * This service is used to rollback a page version from the toolbar context.\r\n */\r\nvar /* @ngInject */ RollbackPageVersionService = /** @class */ (function () {\r\n    function /* @ngInject */ RollbackPageVersionService(logService, alertService, confirmationModalService, experienceService, pageInfoService, pageVersioningService, pageVersionSelectionService, systemEventService) {\r\n        this.logService = logService;\r\n        this.alertService = alertService;\r\n        this.confirmationModalService = confirmationModalService;\r\n        this.experienceService = experienceService;\r\n        this.pageInfoService = pageInfoService;\r\n        this.pageVersioningService = pageVersioningService;\r\n        this.pageVersionSelectionService = pageVersionSelectionService;\r\n        this.systemEventService = systemEventService;\r\n    }\r\n    /* @ngInject */ RollbackPageVersionService.prototype.rollbackPageVersion = function (version) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var pageVersion, TRANSLATE_NS, pageUuid;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        pageVersion = version || this.pageVersionSelectionService.getSelectedPageVersion();\r\n                        if (!!!pageVersion) return [3 /*break*/, 4];\r\n                        TRANSLATE_NS = 'se.cms.actionitem.page.version.rollback.confirmation';\r\n                        return [4 /*yield*/, this.pageInfoService.getPageUUID()];\r\n                    case 1:\r\n                        pageUuid = _a.sent();\r\n                        return [4 /*yield*/, this.showConfirmationModal(pageVersion.label, TRANSLATE_NS)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.performRollback(pageUuid, pageVersion)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        _a.label = 4;\r\n                    case 4: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    // Warning! This method is patched in personalization module, be careful when modifying it.\r\n    /* @ngInject */ RollbackPageVersionService.prototype.showConfirmationModal = function (versionLabel, translateNs) {\r\n        return this.confirmationModalService.confirm({\r\n            title: translateNs + \".title\",\r\n            description: translateNs + \".description\",\r\n            descriptionPlaceholders: {\r\n                versionLabel: versionLabel\r\n            }\r\n        });\r\n    };\r\n    /* @ngInject */ RollbackPageVersionService.prototype.performRollback = function (pageUuid, pageVersion) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _b.trys.push([0, 3, , 4]);\r\n                        return [4 /*yield*/, this.pageVersioningService.rollbackPageVersion(pageUuid, pageVersion.uid)];\r\n                    case 1:\r\n                        _b.sent();\r\n                        // invalidate the content catalog cache: a rollback of a page could replace the existing homepage.\r\n                        this.systemEventService.publishAsync(EVENT_CONTENT_CATALOG_UPDATE);\r\n                        this.alertService.showSuccess('se.cms.versions.rollback.alert.success');\r\n                        // reload experience\r\n                        return [4 /*yield*/, this.experienceService.updateExperience({})];\r\n                    case 2:\r\n                        // reload experience\r\n                        _b.sent();\r\n                        this.pageVersionSelectionService.deselectPageVersion(false);\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        _a = _b.sent();\r\n                        this.logService.error('RollbackPageVersionService::performRollback - unable to perform page rollback');\r\n                        return [3 /*break*/, 4];\r\n                    case 4: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /* @ngInject */ RollbackPageVersionService = __decorate([\r\n        SeDowngradeService(),\r\n        __metadata(\"design:paramtypes\", [LogService,\r\n            IAlertService,\r\n            IConfirmationModalService,\r\n            IExperienceService,\r\n            IPageInfoService,\r\n            PageVersioningService,\r\n            PageVersionSelectionService,\r\n            SystemEventService])\r\n    ], /* @ngInject */ RollbackPageVersionService);\r\n    return /* @ngInject */ RollbackPageVersionService;\r\n}());\r\nexport { /* @ngInject */ RollbackPageVersionService };\r\n//# sourceMappingURL=RollbackPageVersionService.js.map","references":["/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/components/versioning/services/PageVersioningService.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/components/versioning/services/PageVersionSelectionService.ts"],"map":"{\"version\":3,\"file\":\"RollbackPageVersionService.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/components/versioning/services/RollbackPageVersionService.ts\"],\"names\":[],\"mappings\":\";AAAA;;GAEG;AACH,OAAO,EAEH,4BAA4B,EAC5B,aAAa,EACb,yBAAyB,EACzB,kBAAkB,EAClB,gBAAgB,EAChB,UAAU,EACV,kBAAkB,EAClB,kBAAkB,EACrB,MAAM,kBAAkB,CAAC;AAC1B,OAAO,EAAgB,qBAAqB,EAAE,MAAM,yBAAyB,CAAC;AAC9E,OAAO,EAAE,2BAA2B,EAAE,MAAM,+BAA+B,CAAC;AAE5E;;GAEG;AAEH;IACI,oDACY,UAAsB,EACtB,YAA2B,EAC3B,wBAAmD,EACnD,iBAAqC,EACrC,eAAiC,EACjC,qBAA4C,EAC5C,2BAAwD,EACxD,kBAAsC;QAPtC,eAAU,GAAV,UAAU,CAAY;QACtB,iBAAY,GAAZ,YAAY,CAAe;QAC3B,6BAAwB,GAAxB,wBAAwB,CAA2B;QACnD,sBAAiB,GAAjB,iBAAiB,CAAoB;QACrC,oBAAe,GAAf,eAAe,CAAkB;QACjC,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,gCAA2B,GAA3B,2BAA2B,CAA6B;QACxD,uBAAkB,GAAlB,kBAAkB,CAAoB;IAC/C,CAAC;IAES,wEAAmB,GAAhC,UAAiC,OAAsB;;;;;;wBAC7C,WAAW,GAAG,OAAO,IAAI,IAAI,CAAC,2BAA2B,CAAC,sBAAsB,EAAE,CAAC;6BACrF,CAAC,CAAC,WAAW,EAAb,wBAAa;wBACP,YAAY,GAAG,sDAAsD,CAAC;wBAC3D,qBAAM,IAAI,CAAC,eAAe,CAAC,WAAW,EAAE,EAAA;;wBAAnD,QAAQ,GAAG,SAAwC;wBACzD,qBAAM,IAAI,CAAC,qBAAqB,CAAC,WAAW,CAAC,KAAK,EAAE,YAAY,CAAC,EAAA;;wBAAjE,SAAiE,CAAC;wBAClE,qBAAM,IAAI,CAAC,eAAe,CAAC,QAAQ,EAAE,WAAW,CAAC,EAAA;;wBAAjD,SAAiD,CAAC;;;;;;KAEzD;IAED,2FAA2F;IACnF,0EAAqB,GAA7B,UAA8B,YAAoB,EAAE,WAAmB;QACnE,OAAO,IAAI,CAAC,wBAAwB,CAAC,OAAO,CAAC;YACzC,KAAK,EAAK,WAAW,WAAQ;YAC7B,WAAW,EAAK,WAAW,iBAAc;YACzC,uBAAuB,EAAE;gBACrB,YAAY,cAAA;aACf;SACuB,CAAC,CAAC;IAClC,CAAC;IAEa,oEAAe,GAA7B,UAA8B,QAAgB,EAAE,WAAyB;;;;;;;wBAEjE,qBAAM,IAAI,CAAC,qBAAqB,CAAC,mBAAmB,CAAC,QAAQ,EAAE,WAAW,CAAC,GAAG,CAAC,EAAA;;wBAA/E,SAA+E,CAAC;wBAEhF,kGAAkG;wBAClG,IAAI,CAAC,kBAAkB,CAAC,YAAY,CAAC,4BAA4B,CAAC,CAAC;wBACnE,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,wCAAwC,CAAC,CAAC;wBACxE,oBAAoB;wBACpB,qBAAM,IAAI,CAAC,iBAAiB,CAAC,gBAAgB,CAAC,EAAE,CAAC,EAAA;;wBADjD,oBAAoB;wBACpB,SAAiD,CAAC;wBAClD,IAAI,CAAC,2BAA2B,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC;;;;wBAE5D,IAAI,CAAC,UAAU,CAAC,KAAK,CACjB,+EAA+E,CAClF,CAAC;;;;;;KAET;IAhDL;QADC,kBAAkB,EAAE;yCAGO,UAAU;YACR,aAAa;YACD,yBAAyB;YAChC,kBAAkB;YACpB,gBAAgB;YACV,qBAAqB;YACf,2BAA2B;YACpC,kBAAkB;kDAwCrD;IAAD,iDAAC;CAAA,AAjDD,IAiDC\"}","dts":{"name":"/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/components/versioning/services/RollbackPageVersionService.d.ts","writeByteOrderMark":false,"text":"import { IAlertService, IConfirmationModalService, IExperienceService, IPageInfoService, LogService, SystemEventService } from 'smarteditcommons';\r\nimport { IPageVersion, PageVersioningService } from './PageVersioningService';\r\nimport { PageVersionSelectionService } from './PageVersionSelectionService';\r\n/**\r\n * This service is used to rollback a page version from the toolbar context.\r\n */\r\nexport declare class RollbackPageVersionService {\r\n    private logService;\r\n    private alertService;\r\n    private confirmationModalService;\r\n    private experienceService;\r\n    private pageInfoService;\r\n    private pageVersioningService;\r\n    private pageVersionSelectionService;\r\n    private systemEventService;\r\n    constructor(logService: LogService, alertService: IAlertService, confirmationModalService: IConfirmationModalService, experienceService: IExperienceService, pageInfoService: IPageInfoService, pageVersioningService: PageVersioningService, pageVersionSelectionService: PageVersionSelectionService, systemEventService: SystemEventService);\r\n    rollbackPageVersion(version?: IPageVersion): Promise<void>;\r\n    private showConfirmationModal;\r\n    private performRollback;\r\n}\r\n"}}
