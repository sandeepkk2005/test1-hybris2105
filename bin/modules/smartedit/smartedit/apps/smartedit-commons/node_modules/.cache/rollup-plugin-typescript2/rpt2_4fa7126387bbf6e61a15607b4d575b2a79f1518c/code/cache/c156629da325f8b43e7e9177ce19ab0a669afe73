{"code":"import { __decorate, __metadata, __spreadArrays } from \"tslib\";\r\nimport { ChangeDetectorRef, Component, ElementRef, EventEmitter, Input, Output, ViewChild, ViewEncapsulation } from '@angular/core';\r\nimport { differenceBy } from 'lodash';\r\nimport ResizeObserver from 'resize-observer-polyfill';\r\nimport { SeDowngradeComponent } from '../../di';\r\nimport { stringUtils, DiscardablePromiseUtils } from '../../utils';\r\nwindow.__smartedit__.addDecoratorPayload(\"Component\", \"InfiniteScrollingComponent\", {\r\n    selector: 'se-infinite-scrolling',\r\n    template: \"<div #container class=\\\"se-infinite-scrolling__container\\\" [ngClass]=\\\"dropDownContainerClass\\\" fdInfiniteScroll (onScrollAction)=\\\"nextPage()\\\" [scrollPercent]=\\\"distance\\\" *ngIf=\\\"initiated\\\"><div class=\\\"se-infinite-scrolling__holder\\\" [ngClass]=\\\"dropDownClass\\\"><div #content><ng-content></ng-content></div><div class=\\\"spinner-container\\\"><se-spinner [isSpinning]=\\\"isLoading\\\" [isFluid]=\\\"false\\\"></se-spinner></div></div></div>\",\r\n    styles: [\"se-infinite-scrolling.se-infinite-scrolling--narrowed .se-infinite-scrolling__holder{padding:0 20px}se-infinite-scrolling .se-infinite-scrolling__container{overflow-y:auto;max-height:200px}se-infinite-scrolling .se-infinite-scrolling__holder{overflow-y:hidden}\"],\r\n    encapsulation: ViewEncapsulation.None\r\n});\r\nvar /* @ngInject */ InfiniteScrollingComponent = /** @class */ (function () {\r\n    function /* @ngInject */ InfiniteScrollingComponent(discardablePromiseUtils, cdr) {\r\n        this.discardablePromiseUtils = discardablePromiseUtils;\r\n        this.cdr = cdr;\r\n        this.distance = 80;\r\n        this.itemsChange = new EventEmitter();\r\n        this.containerId = stringUtils.generateIdentifier();\r\n        this.initiated = false;\r\n        this.isLoading = false;\r\n    }\r\n    /* @ngInject */ InfiniteScrollingComponent.prototype.ngOnInit = function () {\r\n        this.init();\r\n    };\r\n    /* @ngInject */ InfiniteScrollingComponent.prototype.ngOnChanges = function () {\r\n        this.context = this.context || this;\r\n        this.init();\r\n    };\r\n    /* @ngInject */ InfiniteScrollingComponent.prototype.ngAfterViewInit = function () {\r\n        this.initContentResizeObserver();\r\n    };\r\n    /* @ngInject */ InfiniteScrollingComponent.prototype.ngOnDestroy = function () {\r\n        this.discardablePromiseUtils.clear(this.containerId);\r\n        this.contentResizeObserver.disconnect();\r\n    };\r\n    /* @ngInject */ InfiniteScrollingComponent.prototype.nextPage = function () {\r\n        var _this = this;\r\n        if (this.pagingDisabled) {\r\n            return;\r\n        }\r\n        this.pagingDisabled = true;\r\n        this.currentPage = this.currentPage + 1;\r\n        this.mask = this.mask || '';\r\n        this.isLoading = true;\r\n        this.discardablePromiseUtils.apply(this.containerId, this.fetchPage(this.mask, this.pageSize, this.currentPage), function (page) {\r\n            page.results = page.results || [];\r\n            page.results.forEach(function (element) {\r\n                element.technicalUniqueId = stringUtils.encode(element);\r\n            });\r\n            var uniqueResults = differenceBy(page.results, _this.context.items, 'technicalUniqueId');\r\n            if (uniqueResults.length > 0) {\r\n                _this.context.items = __spreadArrays(_this.context.items, (uniqueResults || []));\r\n            }\r\n            _this.itemsChange.emit(_this.context.items);\r\n            _this.pagingDisabled =\r\n                page.results.length === 0 ||\r\n                    (page.pagination && _this.context.items.length === page.pagination.totalCount);\r\n            if (_this.context.items.length === 0 &&\r\n                page.pagination.page < page.pagination.totalPages) {\r\n                _this.pagingDisabled = false;\r\n                _this.nextPage();\r\n            }\r\n            if (_this.pagingDisabled) {\r\n                _this.isLoading = false;\r\n                _this.cdr.detectChanges();\r\n                return;\r\n            }\r\n        });\r\n    };\r\n    /* @ngInject */ InfiniteScrollingComponent.prototype.scrollToTop = function () {\r\n        if (this.containerElement) {\r\n            this.containerElement.nativeElement.scrollTop = 0;\r\n        }\r\n    };\r\n    /* @ngInject */ InfiniteScrollingComponent.prototype.scrollToBottom = function () {\r\n        if (this.containerElement) {\r\n            this.containerElement.nativeElement.scrollTop = this.containerElement.nativeElement.scrollHeight;\r\n        }\r\n    };\r\n    /* @ngInject */ InfiniteScrollingComponent.prototype.init = function () {\r\n        var wasInitiated = this.initiated;\r\n        this.context.items = [];\r\n        this.currentPage = -1;\r\n        this.pagingDisabled = false;\r\n        this.initiated = true;\r\n        if (wasInitiated) {\r\n            this.scrollToTop();\r\n            this.nextPage();\r\n        }\r\n    };\r\n    /* @ngInject */ InfiniteScrollingComponent.prototype.initContentResizeObserver = function () {\r\n        var _this = this;\r\n        this.contentResizeObserver = new ResizeObserver(function (entries) {\r\n            var contentRect = entries[0].contentRect;\r\n            var isInitialChange = contentRect.height === 0;\r\n            if (!_this.pagingDisabled && _this.isLoading && !isInitialChange) {\r\n                if (_this.shouldLoadNextPage()) {\r\n                    _this.nextPage();\r\n                }\r\n                else {\r\n                    _this.isLoading = false;\r\n                    _this.cdr.detectChanges();\r\n                }\r\n                _this.contentResizeObserver.disconnect();\r\n            }\r\n        });\r\n        this.contentResizeObserver.observe(this.contentElement.nativeElement);\r\n    };\r\n    /* @ngInject */ InfiniteScrollingComponent.prototype.shouldLoadNextPage = function () {\r\n        var contentHeight = this.contentElement.nativeElement.offsetHeight;\r\n        var containerHeight = this.containerElement.nativeElement.offsetHeight;\r\n        var shouldLoad = contentHeight <= containerHeight;\r\n        return shouldLoad;\r\n    };\r\n    __decorate([\r\n        Input(),\r\n        __metadata(\"design:type\", Number)\r\n    ], /* @ngInject */ InfiniteScrollingComponent.prototype, \"pageSize\", void 0);\r\n    __decorate([\r\n        Input(),\r\n        __metadata(\"design:type\", String)\r\n    ], /* @ngInject */ InfiniteScrollingComponent.prototype, \"mask\", void 0);\r\n    __decorate([\r\n        Input(),\r\n        __metadata(\"design:type\", String)\r\n    ], /* @ngInject */ InfiniteScrollingComponent.prototype, \"dropDownContainerClass\", void 0);\r\n    __decorate([\r\n        Input(),\r\n        __metadata(\"design:type\", String)\r\n    ], /* @ngInject */ InfiniteScrollingComponent.prototype, \"dropDownClass\", void 0);\r\n    __decorate([\r\n        Input(),\r\n        __metadata(\"design:type\", Object)\r\n    ], /* @ngInject */ InfiniteScrollingComponent.prototype, \"distance\", void 0);\r\n    __decorate([\r\n        Input(),\r\n        __metadata(\"design:type\", Object)\r\n    ], /* @ngInject */ InfiniteScrollingComponent.prototype, \"context\", void 0);\r\n    __decorate([\r\n        Input(),\r\n        __metadata(\"design:type\", Function)\r\n    ], /* @ngInject */ InfiniteScrollingComponent.prototype, \"fetchPage\", void 0);\r\n    __decorate([\r\n        Output(),\r\n        __metadata(\"design:type\", Object)\r\n    ], /* @ngInject */ InfiniteScrollingComponent.prototype, \"itemsChange\", void 0);\r\n    __decorate([\r\n        ViewChild('container', { static: false }),\r\n        __metadata(\"design:type\", ElementRef)\r\n    ], /* @ngInject */ InfiniteScrollingComponent.prototype, \"containerElement\", void 0);\r\n    __decorate([\r\n        ViewChild('content', { static: false }),\r\n        __metadata(\"design:type\", ElementRef)\r\n    ], /* @ngInject */ InfiniteScrollingComponent.prototype, \"contentElement\", void 0);\r\n    /* @ngInject */ InfiniteScrollingComponent = __decorate([\r\n        SeDowngradeComponent(),\r\n        Component({\r\n            selector: 'se-infinite-scrolling',\r\n            template: \"<div #container class=\\\"se-infinite-scrolling__container\\\" [ngClass]=\\\"dropDownContainerClass\\\" fdInfiniteScroll (onScrollAction)=\\\"nextPage()\\\" [scrollPercent]=\\\"distance\\\" *ngIf=\\\"initiated\\\"><div class=\\\"se-infinite-scrolling__holder\\\" [ngClass]=\\\"dropDownClass\\\"><div #content><ng-content></ng-content></div><div class=\\\"spinner-container\\\"><se-spinner [isSpinning]=\\\"isLoading\\\" [isFluid]=\\\"false\\\"></se-spinner></div></div></div>\",\r\n            styles: [\"se-infinite-scrolling.se-infinite-scrolling--narrowed .se-infinite-scrolling__holder{padding:0 20px}se-infinite-scrolling .se-infinite-scrolling__container{overflow-y:auto;max-height:200px}se-infinite-scrolling .se-infinite-scrolling__holder{overflow-y:hidden}\"],\r\n            encapsulation: ViewEncapsulation.None\r\n        }),\r\n        __metadata(\"design:paramtypes\", [DiscardablePromiseUtils,\r\n            ChangeDetectorRef])\r\n    ], /* @ngInject */ InfiniteScrollingComponent);\r\n    return /* @ngInject */ InfiniteScrollingComponent;\r\n}());\r\nexport { /* @ngInject */ InfiniteScrollingComponent };\r\n//# sourceMappingURL=InfiniteScrollingComponent.js.map","references":["/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular/core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/dist/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@types/lodash@4.14.159/node_modules/@types/lodash/ts3.1/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/resize-observer-polyfill@1.5.1/node_modules/resize-observer-polyfill/src/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/di/index.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/utils/index.ts"],"map":"{\"version\":3,\"file\":\"InfiniteScrollingComponent.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/components/infiniteScrolling/InfiniteScrollingComponent.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/components/infiniteScrolling/InfiniteScrollingComponent.d.ts","writeByteOrderMark":false,"text":"import { AfterViewInit, ChangeDetectorRef, ElementRef, EventEmitter, OnChanges, OnInit } from '@angular/core';\r\nimport { Page } from '@smart/utils';\r\nimport { DiscardablePromiseUtils } from '../../utils';\r\nexport interface TechnicalUniqueIdAware {\r\n    technicalUniqueId: string;\r\n}\r\nexport declare class InfiniteScrollingComponent<T extends TechnicalUniqueIdAware> implements OnInit, OnChanges, AfterViewInit {\r\n    private discardablePromiseUtils;\r\n    private cdr;\r\n    pageSize: number;\r\n    mask: string;\r\n    dropDownContainerClass: string;\r\n    dropDownClass: string;\r\n    distance: number;\r\n    context: {\r\n        items: T[];\r\n    };\r\n    fetchPage: (mask: string, pageSize: number, currentPage: number) => Promise<Page<T>>;\r\n    itemsChange: EventEmitter<T[]>;\r\n    containerElement: ElementRef<HTMLDivElement>;\r\n    contentElement: ElementRef<HTMLDivElement>;\r\n    containerId: string;\r\n    items: T[];\r\n    initiated: boolean;\r\n    currentPage: number;\r\n    pagingDisabled: boolean;\r\n    isLoading: boolean;\r\n    private contentResizeObserver;\r\n    constructor(discardablePromiseUtils: DiscardablePromiseUtils, cdr: ChangeDetectorRef);\r\n    ngOnInit(): void;\r\n    ngOnChanges(): void;\r\n    ngAfterViewInit(): void;\r\n    ngOnDestroy(): void;\r\n    nextPage(): void;\r\n    scrollToTop(): void;\r\n    scrollToBottom(): void;\r\n    private init;\r\n    private initContentResizeObserver;\r\n    private shouldLoadNextPage;\r\n}\r\n"}}
