{"code":"import { __awaiter, __decorate, __generator, __metadata } from \"tslib\";\r\nimport { ICatalogService, SeDowngradeService } from 'smarteditcommons';\r\nimport { ContextAwarePageStructureService } from '../ContextAwarePageStructureService';\r\nvar PageBuilder = /** @class */ (function () {\r\n    function PageBuilder(catalogService, contextAwarePageStructureService, restrictionsStepHandler, uriContext) {\r\n        var _this = this;\r\n        this.catalogService = catalogService;\r\n        this.contextAwarePageStructureService = contextAwarePageStructureService;\r\n        this.restrictionsStepHandler = restrictionsStepHandler;\r\n        this.uriContext = uriContext;\r\n        this.model = {};\r\n        this.page = {\r\n            restrictions: []\r\n        };\r\n        this.catalogService.getCatalogVersionUUid(this.uriContext).then(function (catalogVersionUuid) {\r\n            _this.page.catalogVersion = catalogVersionUuid;\r\n        });\r\n    }\r\n    PageBuilder.prototype.pageTypeSelected = function (pageTypeObject) {\r\n        this.model.pageType = pageTypeObject;\r\n        this.model.pageTemplate = null;\r\n        return this.updatePageInfoFields();\r\n    };\r\n    PageBuilder.prototype.pageTemplateSelected = function (pageTemplateObject) {\r\n        this.model.pageTemplate = pageTemplateObject;\r\n    };\r\n    PageBuilder.prototype.getPageTypeCode = function () {\r\n        var _a;\r\n        return ((_a = this.model.pageType) === null || _a === void 0 ? void 0 : _a.code) || null;\r\n    };\r\n    PageBuilder.prototype.getTemplateUuid = function () {\r\n        var _a;\r\n        return ((_a = this.model.pageTemplate) === null || _a === void 0 ? void 0 : _a.uuid) || '';\r\n    };\r\n    PageBuilder.prototype.getPage = function () {\r\n        var _a, _b;\r\n        this.page.typeCode = this.getPageTypeCode();\r\n        this.page.itemtype = this.page.typeCode;\r\n        this.page.type = ((_a = this.model.pageType) === null || _a === void 0 ? void 0 : _a.type) || null;\r\n        this.page.masterTemplate = this.getTemplateUuid() || null;\r\n        this.page.template = ((_b = this.model.pageTemplate) === null || _b === void 0 ? void 0 : _b.uid) || null;\r\n        return this.page;\r\n    };\r\n    PageBuilder.prototype.getPageRestrictions = function () {\r\n        return this.page.restrictions;\r\n    };\r\n    PageBuilder.prototype.setPageUid = function (uid) {\r\n        this.page.uid = uid;\r\n    };\r\n    PageBuilder.prototype.setRestrictions = function (onlyOneRestrictionMustApply, restrictions) {\r\n        this.page.onlyOneRestrictionMustApply = onlyOneRestrictionMustApply;\r\n        this.page.restrictions = restrictions;\r\n    };\r\n    PageBuilder.prototype.getPageInfoStructure = function () {\r\n        return this.model.pageInfoFields;\r\n    };\r\n    PageBuilder.prototype.displayConditionSelected = function (displayConditionResult) {\r\n        var isPrimaryPage = displayConditionResult.isPrimary;\r\n        this.page.defaultPage = isPrimaryPage;\r\n        this.page.homepage = displayConditionResult.homepage;\r\n        if (isPrimaryPage) {\r\n            this.page.label = null;\r\n            this.restrictionsStepHandler.hideStep();\r\n        }\r\n        else {\r\n            this.page.label = displayConditionResult.primaryPage\r\n                ? displayConditionResult.primaryPage.label\r\n                : '';\r\n            this.restrictionsStepHandler.showStep();\r\n        }\r\n        return this.updatePageInfoFields();\r\n    };\r\n    PageBuilder.prototype.updatePageInfoFields = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var pageInfoFields;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!(this.page.defaultPage !== undefined)) return [3 /*break*/, 3];\r\n                        if (!this.model.pageType) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.contextAwarePageStructureService.getPageStructureForNewPage(this.model.pageType.code, this.page.defaultPage)];\r\n                    case 1:\r\n                        pageInfoFields = _a.sent();\r\n                        this.model.pageInfoFields = pageInfoFields;\r\n                        return [3 /*break*/, 3];\r\n                    case 2:\r\n                        this.model.pageInfoFields = {};\r\n                        _a.label = 3;\r\n                    case 3: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return PageBuilder;\r\n}());\r\nexport { PageBuilder };\r\nvar /* @ngInject */ PageBuilderFactory = /** @class */ (function () {\r\n    function /* @ngInject */ PageBuilderFactory(catalogService, contextAwarePageStructureService) {\r\n        this.catalogService = catalogService;\r\n        this.contextAwarePageStructureService = contextAwarePageStructureService;\r\n    }\r\n    /* @ngInject */ PageBuilderFactory.prototype.createPageBuilder = function (restrictionsStepHandler, uriContext) {\r\n        return new PageBuilder(this.catalogService, this.contextAwarePageStructureService, restrictionsStepHandler, uriContext);\r\n    };\r\n    /* @ngInject */ PageBuilderFactory = __decorate([\r\n        SeDowngradeService(),\r\n        __metadata(\"design:paramtypes\", [ICatalogService,\r\n            ContextAwarePageStructureService])\r\n    ], /* @ngInject */ PageBuilderFactory);\r\n    return /* @ngInject */ PageBuilderFactory;\r\n}());\r\nexport { /* @ngInject */ PageBuilderFactory };\r\n//# sourceMappingURL=PageBuilderFactory.js.map","references":["/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-commons/dist/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/dao/PageTypeService.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/interfaces/index.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/services/ContextAwarePageStructureService.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/services/pages/types.ts"],"map":"{\"version\":3,\"file\":\"PageBuilderFactory.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/services/pages/PageBuilderFactory.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/services/pages/PageBuilderFactory.d.ts","writeByteOrderMark":false,"text":"import { CMSPageTypes, ICMSPage } from 'cmscommons';\r\nimport { GenericEditorStructure, ICatalogService, IUriContext, Nullable } from 'smarteditcommons';\r\nimport { PageType } from '../../dao/PageTypeService';\r\nimport { IRestrictionsStepHandler } from '../../interfaces';\r\nimport { ContextAwarePageStructureService } from '../ContextAwarePageStructureService';\r\nimport { PageTemplateType } from './types';\r\nexport declare class PageBuilder {\r\n    private catalogService;\r\n    private contextAwarePageStructureService;\r\n    private restrictionsStepHandler;\r\n    private uriContext;\r\n    private model;\r\n    private page;\r\n    constructor(catalogService: ICatalogService, contextAwarePageStructureService: ContextAwarePageStructureService, restrictionsStepHandler: IRestrictionsStepHandler, uriContext: IUriContext);\r\n    pageTypeSelected(pageTypeObject: PageType): Promise<void>;\r\n    pageTemplateSelected(pageTemplateObject: PageTemplateType): void;\r\n    getPageTypeCode(): Nullable<CMSPageTypes>;\r\n    getTemplateUuid(): string;\r\n    getPage(): ICMSPage;\r\n    getPageRestrictions(): string[];\r\n    setPageUid(uid: string): void;\r\n    setRestrictions(onlyOneRestrictionMustApply: boolean, restrictions: string[]): void;\r\n    getPageInfoStructure(): GenericEditorStructure;\r\n    displayConditionSelected(displayConditionResult: ICMSPage): Promise<void>;\r\n    private updatePageInfoFields;\r\n}\r\nexport declare class PageBuilderFactory {\r\n    private catalogService;\r\n    private contextAwarePageStructureService;\r\n    constructor(catalogService: ICatalogService, contextAwarePageStructureService: ContextAwarePageStructureService);\r\n    createPageBuilder(restrictionsStepHandler: IRestrictionsStepHandler, uriContext: IUriContext): PageBuilder;\r\n}\r\n"}}
