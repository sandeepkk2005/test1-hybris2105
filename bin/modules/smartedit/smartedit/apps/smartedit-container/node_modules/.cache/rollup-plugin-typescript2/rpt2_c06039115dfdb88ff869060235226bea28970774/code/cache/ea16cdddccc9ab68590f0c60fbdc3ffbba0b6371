{"code":"import { __decorate, __metadata, __spreadArrays } from \"tslib\";\r\n/*\r\n * Copyright (c) 2021 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { authorizationEvictionTag, rarelyChangingContent, Cached, OperationContextRegistered, RestServiceFactory, SeDowngradeService, SITES_RESOURCE_URI } from 'smarteditcommons';\r\n/**\r\n * The Site Service fetches all sites configured on the hybris platform using REST calls to the cmswebservices sites API.\r\n */\r\nvar /* @ngInject */ SiteService = /** @class */ (function () {\r\n    function /* @ngInject */ SiteService(restServiceFactory) {\r\n        this.SITES_FOR_CATALOGS_URI = '/cmswebservices/v1/sites/catalogs';\r\n        this.cache = null;\r\n        this.siteRestService = restServiceFactory.get(SITES_RESOURCE_URI);\r\n        this.sitesForCatalogsRestService = restServiceFactory.get(this.SITES_FOR_CATALOGS_URI);\r\n    }\r\n    /**\r\n     * Fetches a list of sites for which user has at-least read access to one of the non-active catalog versions.\r\n     *\r\n     * @returns A promise of [ISite]{@link ISite} array.\r\n     */\r\n    /* @ngInject */ SiteService.prototype.getAccessibleSites = function () {\r\n        return this.siteRestService.get({}).then(function (sitesDTO) { return sitesDTO.sites; });\r\n    };\r\n    /**\r\n     * Fetches a list of sites configured for accessible sites. The list of sites fetched using REST calls through\r\n     * the cmswebservices sites API.\r\n     *\r\n     * @returns A promise of [ISite]{@link ISite} array.\r\n     */\r\n    /* @ngInject */ SiteService.prototype.getSites = function () {\r\n        var _this = this;\r\n        //  Uses two REST API calls because of multicountry. The first call gives all the sites for which the user has permissions to.\r\n        return this.getAccessibleSites().then(function (sites) {\r\n            var catalogIds = sites.reduce(function (catalogs, site) { return __spreadArrays((catalogs || []), site.contentCatalogs); }, []);\r\n            // The call with catalogIds gives all the corresponding sites in the hierarchy.\r\n            return _this.sitesForCatalogsRestService\r\n                .save({\r\n                catalogIds: catalogIds\r\n            })\r\n                .then(function (allSites) {\r\n                _this.cache = allSites.sites;\r\n                return _this.cache;\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Fetches a site, configured on the hybris platform, by its uid. The sites fetched using REST calls through\r\n     * cmswebservices sites API.\r\n     *\r\n     * @param uid unique site ID\r\n     * @returns A promise of [ISite]{@link ISite}.\r\n     */\r\n    /* @ngInject */ SiteService.prototype.getSiteById = function (uid) {\r\n        return this.getSites().then(function (sites) { return sites.find(function (site) { return site.uid === uid; }); });\r\n    };\r\n    __decorate([\r\n        Cached({ actions: [rarelyChangingContent], tags: [authorizationEvictionTag] }),\r\n        __metadata(\"design:type\", Function),\r\n        __metadata(\"design:paramtypes\", []),\r\n        __metadata(\"design:returntype\", Promise)\r\n    ], /* @ngInject */ SiteService.prototype, \"getAccessibleSites\", null);\r\n    __decorate([\r\n        Cached({ actions: [rarelyChangingContent], tags: [authorizationEvictionTag] }),\r\n        __metadata(\"design:type\", Function),\r\n        __metadata(\"design:paramtypes\", []),\r\n        __metadata(\"design:returntype\", Promise)\r\n    ], /* @ngInject */ SiteService.prototype, \"getSites\", null);\r\n    /* @ngInject */ SiteService = __decorate([\r\n        SeDowngradeService(),\r\n        OperationContextRegistered('SITES_RESOURCE_URI', 'CMS'),\r\n        __metadata(\"design:paramtypes\", [RestServiceFactory])\r\n    ], /* @ngInject */ SiteService);\r\n    return /* @ngInject */ SiteService;\r\n}());\r\nexport { /* @ngInject */ SiteService };\r\n//# sourceMappingURL=SiteService.js.map","references":["/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts"],"map":"{\"version\":3,\"file\":\"SiteService.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/services/SiteService.ts\"],\"names\":[],\"mappings\":\";AAAA;;GAEG;AACH,OAAO,EACH,wBAAwB,EACxB,qBAAqB,EACrB,MAAM,EAGN,0BAA0B,EAC1B,kBAAkB,EAClB,kBAAkB,EAClB,kBAAkB,EACrB,MAAM,kBAAkB,CAAC;AAM1B;;GAEG;AAIH;IAOI,qCAAY,kBAAsC;QAFjC,2BAAsB,GAAG,mCAAmC,CAAC;QAG1E,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;QAClB,IAAI,CAAC,eAAe,GAAG,kBAAkB,CAAC,GAAG,CAAW,kBAAkB,CAAC,CAAC;QAC5E,IAAI,CAAC,2BAA2B,GAAG,kBAAkB,CAAC,GAAG,CACrD,IAAI,CAAC,sBAAsB,CAC9B,CAAC;IACN,CAAC;IAED;;;;OAIG;IAEH,wDAAkB,GAAlB;QACI,OAAO,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,UAAC,QAAkB,IAAK,OAAA,QAAQ,CAAC,KAAK,EAAd,CAAc,CAAC,CAAC;IACrF,CAAC;IAED;;;;;OAKG;IAEH,8CAAQ,GAAR;QADA,iBAoBC;QAlBG,8HAA8H;QAC9H,OAAO,IAAI,CAAC,kBAAkB,EAAE,CAAC,IAAI,CAAC,UAAC,KAAK;YACxC,IAAM,UAAU,GAAa,KAAK,CAAC,MAAM,CACrC,UAAC,QAAkB,EAAE,IAAW,IAAK,sBAAI,CAAC,QAAQ,IAAI,EAAE,CAAC,EAAK,IAAI,CAAC,eAAe,GAA7C,CAA8C,EACnF,EAAE,CACL,CAAC;YAEF,+EAA+E;YAC/E,OAAO,KAAI,CAAC,2BAA2B;iBAClC,IAAI,CAAC;gBACF,UAAU,YAAA;aACb,CAAC;iBAED,IAAI,CAAC,UAAC,QAAkB;gBACrB,KAAI,CAAC,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC;gBAC5B,OAAO,KAAI,CAAC,KAAK,CAAC;YACtB,CAAC,CAAC,CAAC;QACX,CAAC,CAAC,CAAC;IACP,CAAC;IAED;;;;;;OAMG;IACH,iDAAW,GAAX,UAAY,GAAW;QACnB,OAAO,IAAI,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC,UAAC,KAAc,IAAK,OAAA,KAAK,CAAC,IAAI,CAAC,UAAC,IAAI,IAAK,OAAA,IAAI,CAAC,GAAG,KAAK,GAAG,EAAhB,CAAgB,CAAC,EAAtC,CAAsC,CAAC,CAAC;IAC5F,CAAC;IAzCD;QADC,MAAM,CAAC,EAAE,OAAO,EAAE,CAAC,qBAAqB,CAAC,EAAE,IAAI,EAAE,CAAC,wBAAwB,CAAC,EAAE,CAAC;;;;yEAG9E;IASD;QADC,MAAM,CAAC,EAAE,OAAO,EAAE,CAAC,qBAAqB,CAAC,EAAE,IAAI,EAAE,CAAC,wBAAwB,CAAC,EAAE,CAAC;;;;+DAoB9E;IAnDL;QAFC,kBAAkB,EAAE;QACpB,0BAA0B,CAAC,oBAAoB,EAAE,KAAK,CAAC;yCAQpB,kBAAkB;mCAwDrD;IAAD,kCAAC;CAAA,AA/DD,IA+DC\"}","dts":{"name":"/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-container/services/SiteService.d.ts","writeByteOrderMark":false,"text":"import { ISite, RestServiceFactory } from 'smarteditcommons';\r\n/**\r\n * The Site Service fetches all sites configured on the hybris platform using REST calls to the cmswebservices sites API.\r\n */\r\nexport declare class SiteService {\r\n    private cache;\r\n    private siteRestService;\r\n    private sitesForCatalogsRestService;\r\n    private readonly SITES_FOR_CATALOGS_URI;\r\n    constructor(restServiceFactory: RestServiceFactory);\r\n    /**\r\n     * Fetches a list of sites for which user has at-least read access to one of the non-active catalog versions.\r\n     *\r\n     * @returns A promise of [ISite]{@link ISite} array.\r\n     */\r\n    getAccessibleSites(): Promise<ISite[]>;\r\n    /**\r\n     * Fetches a list of sites configured for accessible sites. The list of sites fetched using REST calls through\r\n     * the cmswebservices sites API.\r\n     *\r\n     * @returns A promise of [ISite]{@link ISite} array.\r\n     */\r\n    getSites(): Promise<ISite[]>;\r\n    /**\r\n     * Fetches a site, configured on the hybris platform, by its uid. The sites fetched using REST calls through\r\n     * cmswebservices sites API.\r\n     *\r\n     * @param uid unique site ID\r\n     * @returns A promise of [ISite]{@link ISite}.\r\n     */\r\n    getSiteById(uid: string): Promise<ISite>;\r\n}\r\n"}}
