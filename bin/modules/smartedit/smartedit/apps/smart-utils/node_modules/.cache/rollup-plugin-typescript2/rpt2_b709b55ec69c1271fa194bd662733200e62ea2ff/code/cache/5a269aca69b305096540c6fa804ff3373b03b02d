{"code":"import { __spreadArrays } from \"tslib\";\r\n/*\r\n * Copyright (c) 2021 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\n/**\r\n * Copyright (c) 2019 SAP SE or an SAP affiliate company. All rights reserved.\r\n * @module smartutils\r\n */\r\nimport * as lo from 'lodash';\r\nimport { functionsUtils } from '../../utils';\r\nimport { annotationService } from '../annotation.service';\r\n/// ////////////////////////////////////////////////////////////////////////////\r\n/// ////////////////////////////// CACHE CONFIG ////////////////////////////////\r\n/// ////////////////////////////////////////////////////////////////////////////\r\nvar cacheConfigAnnotationName = 'CacheConfig';\r\n/**\r\n * @ngdoc object\r\n * @name @smartutils.object:@CacheConfig\r\n * @description\r\n * Class level typescript {@link http://www.typescriptlang.org/docs/handbook/decorators.html decorator factory} responsible for setting\r\n *  class level cache configuration to be merged into method specific {@link @smartutils.object:@Cached @Cached} and\r\n *  {@link @smartutils.object:@InvalidateCache @InvalidateCache} configurations.\r\n * @param {object} cacheConfig the configuration fo this cache\r\n * @param {cacheAction} cacheConfig.actions the list of {@link @smartutils.object:CacheAction CacheAction} characterizing this cache.\r\n * @param {EvictionTag[]} cacheConfig.tags a list of {@link @smartutils.object:EvictionTag EvictionTag} to control the eviction behaviour of this cache.\r\n */\r\nexport var CacheConfig = annotationService.getClassAnnotationFactory(cacheConfigAnnotationName);\r\nexport function CacheConfigAnnotationFactory(logService) {\r\n    'ngInject';\r\n    return annotationService.setClassAnnotationFactory(cacheConfigAnnotationName, function (factoryArguments) {\r\n        return function (instance, originalConstructor, invocationArguments) {\r\n            originalConstructor.call.apply(originalConstructor, __spreadArrays([instance], invocationArguments));\r\n            instance.cacheConfig = factoryArguments[0];\r\n            logService.debug(\"adding cache config \" + JSON.stringify(instance.cacheConfig) + \" to class \" + functionsUtils.getInstanceConstructorName(instance), instance);\r\n        };\r\n    });\r\n}\r\n/// ////////////////////////////////////////////////////////////////////////////\r\n/// ///////////////////////////////// CACHE ////////////////////////////////////\r\n/// ////////////////////////////////////////////////////////////////////////////\r\nvar CachedAnnotationName = 'Cached';\r\n/**\r\n * @ngdoc object\r\n * @name @smartutils.object:@Cached\r\n * @description\r\n * Method level typescript {@link http://www.typescriptlang.org/docs/handbook/decorators.html decorator factory} responsible for performing\r\n * invocation arguments sensitive method caching.\r\n * <br/> This annotation must only be used on methods returning promises.\r\n * @param {object} cacheConfig the configuration fo this cache\r\n * <br/> This configuration will be merged with a class level {@link @smartutils.object:@CacheConfig @acheConfig} if any.\r\n * @throws if no {@link @smartutils.object:CacheAction CacheAction} is found in the resulting merge\r\n * @param {cacheAction} cacheConfig.actions the list of {@link @smartutils.object:CacheAction CacheAction} characterizing this cache.\r\n * @param {EvictionTag[]} cacheConfig.tags a list of {@link @smartutils.object:EvictionTag EvictionTag} to control the eviction behaviour of this cache.\r\n */\r\nexport var Cached = annotationService.getMethodAnnotationFactory(CachedAnnotationName);\r\nexport function CachedAnnotationFactory(cacheService) {\r\n    'ngInject';\r\n    var result = annotationService.setMethodAnnotationFactory(CachedAnnotationName, function (factoryArguments) {\r\n        return function (target, propertyName, originalMethod, invocationArguments) {\r\n            var actions = [];\r\n            var tags = [];\r\n            if (factoryArguments[0]) {\r\n                actions = factoryArguments[0].actions;\r\n                tags = factoryArguments[0].tags;\r\n            }\r\n            if (target.cacheConfig) {\r\n                if (target.cacheConfig.actions) {\r\n                    actions = lo.uniq(actions.concat(target.cacheConfig.actions));\r\n                }\r\n                if (target.cacheConfig.tags) {\r\n                    tags = lo.uniq(tags.concat(target.cacheConfig.tags));\r\n                }\r\n            }\r\n            if (!actions.length) {\r\n                var constructorName = functionsUtils.getInstanceConstructorName(target);\r\n                throw new Error(\"method \" + propertyName + \" of \" + constructorName + \" is @Cached annotated but no CacheAction is specified either through @Cached or through class level @CacheConfig annotation\");\r\n            }\r\n            return cacheService.handle(target, propertyName, originalMethod, Array.prototype.slice.apply(invocationArguments), actions, tags);\r\n        };\r\n    });\r\n    return result;\r\n}\r\n/// ////////////////////////////////////////////////////////////////////////////\r\n/// /////////////////////////// INVALIDATE CACHE ///////////////////////////////\r\n/// ////////////////////////////////////////////////////////////////////////////\r\nvar InvalidateCacheName = 'InvalidateCache';\r\n/**\r\n * @ngdoc object\r\n * @name @smartutils.object:@InvalidateCache\r\n * @description\r\n * Method level typescript {@link http://www.typescriptlang.org/docs/handbook/decorators.html decorator factory} responsible for\r\n * invalidating all caches either directly or indirectly declaring the {@link @smartutils.object:EvictionTag eviction tag} passed as argument.\r\n * if no eviction tag is passed as argument, defaults to the optional eviction tags passed to the class through {@link @smartutils.object:@CacheConfig @CacheConfig}.\r\n *\r\n * @param {EvictionTag} evictionTag the {@link @smartutils.object:EvictionTag eviction tag}.\r\n */\r\nexport var InvalidateCache = function (tag) {\r\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n    // @ts-ignore\r\n    return annotationService.getMethodAnnotationFactory(InvalidateCacheName)(tag);\r\n};\r\nexport function InvalidateCacheAnnotationFactory(cacheService) {\r\n    'ngInject';\r\n    return annotationService.setMethodAnnotationFactory(InvalidateCacheName, function (factoryArguments) {\r\n        return function (target, propertyName, originalMethod, invocationArguments) {\r\n            var tags = [];\r\n            var tag = factoryArguments[0];\r\n            if (!tag) {\r\n                if (target.cacheConfig && target.cacheConfig.tags) {\r\n                    tags = target.cacheConfig.tags;\r\n                }\r\n            }\r\n            else {\r\n                tags = [tag];\r\n            }\r\n            if (!tags.length) {\r\n                throw new Error(\"method \" + propertyName + \" of \" + target.constructor.name + \" is @InvalidateCache annotated but no EvictionTag is specified either through @InvalidateCache or through class level @CacheConfig annotation\");\r\n            }\r\n            // eslint-disable-next-line prefer-spread\r\n            var returnedObject = originalMethod.apply(undefined, Array.prototype.slice.call(invocationArguments));\r\n            if (returnedObject && returnedObject.then) {\r\n                return returnedObject.then(function (value) {\r\n                    cacheService.evict.apply(cacheService, tags);\r\n                    return value;\r\n                });\r\n            }\r\n            else {\r\n                cacheService.evict.apply(cacheService, tags);\r\n                return returnedObject;\r\n            }\r\n        };\r\n    });\r\n}\r\n//# sourceMappingURL=cached-annotation.js.map","references":["/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@types/lodash@4.14.159/node_modules/@types/lodash/ts3.1/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/src/utils/index.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/src/services/annotation.service.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/src/services/log.service.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/src/services/cache/cache-action.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/src/services/cache/cache.service.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/src/services/cache/eviction-tag.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/src/services/cache/index.ts"],"map":"{\"version\":3,\"file\":\"cached-annotation.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/services/cache/cached-annotation.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/services/cache/cached-annotation.d.ts","writeByteOrderMark":false,"text":"import { ClassAnnotationFactory, MethodAnnotationFactory } from '../annotation.service';\r\nimport { LogService } from '../log.service';\r\nimport { CacheAction } from './cache-action';\r\nimport { CacheService } from './cache.service';\r\nimport { EvictionTag } from './eviction-tag';\r\n/**\r\n * @ngdoc object\r\n * @name @smartutils.object:@CacheConfig\r\n * @description\r\n * Class level typescript {@link http://www.typescriptlang.org/docs/handbook/decorators.html decorator factory} responsible for setting\r\n *  class level cache configuration to be merged into method specific {@link @smartutils.object:@Cached @Cached} and\r\n *  {@link @smartutils.object:@InvalidateCache @InvalidateCache} configurations.\r\n * @param {object} cacheConfig the configuration fo this cache\r\n * @param {cacheAction} cacheConfig.actions the list of {@link @smartutils.object:CacheAction CacheAction} characterizing this cache.\r\n * @param {EvictionTag[]} cacheConfig.tags a list of {@link @smartutils.object:EvictionTag EvictionTag} to control the eviction behaviour of this cache.\r\n */\r\nexport declare const CacheConfig: (args: {\r\n    actions?: CacheAction[];\r\n    tags?: EvictionTag[];\r\n}) => ClassDecorator;\r\nexport declare function CacheConfigAnnotationFactory(logService: LogService): ClassAnnotationFactory;\r\n/**\r\n * @ngdoc object\r\n * @name @smartutils.object:@Cached\r\n * @description\r\n * Method level typescript {@link http://www.typescriptlang.org/docs/handbook/decorators.html decorator factory} responsible for performing\r\n * invocation arguments sensitive method caching.\r\n * <br/> This annotation must only be used on methods returning promises.\r\n * @param {object} cacheConfig the configuration fo this cache\r\n * <br/> This configuration will be merged with a class level {@link @smartutils.object:@CacheConfig @acheConfig} if any.\r\n * @throws if no {@link @smartutils.object:CacheAction CacheAction} is found in the resulting merge\r\n * @param {cacheAction} cacheConfig.actions the list of {@link @smartutils.object:CacheAction CacheAction} characterizing this cache.\r\n * @param {EvictionTag[]} cacheConfig.tags a list of {@link @smartutils.object:EvictionTag EvictionTag} to control the eviction behaviour of this cache.\r\n */\r\nexport declare const Cached: (args?: {\r\n    actions: CacheAction[];\r\n    tags?: EvictionTag[];\r\n}) => MethodDecorator;\r\nexport declare function CachedAnnotationFactory(cacheService: CacheService): MethodAnnotationFactory;\r\n/**\r\n * @ngdoc object\r\n * @name @smartutils.object:@InvalidateCache\r\n * @description\r\n * Method level typescript {@link http://www.typescriptlang.org/docs/handbook/decorators.html decorator factory} responsible for\r\n * invalidating all caches either directly or indirectly declaring the {@link @smartutils.object:EvictionTag eviction tag} passed as argument.\r\n * if no eviction tag is passed as argument, defaults to the optional eviction tags passed to the class through {@link @smartutils.object:@CacheConfig @CacheConfig}.\r\n *\r\n * @param {EvictionTag} evictionTag the {@link @smartutils.object:EvictionTag eviction tag}.\r\n */\r\nexport declare const InvalidateCache: (tag?: EvictionTag) => any;\r\nexport declare function InvalidateCacheAnnotationFactory(cacheService: CacheService): MethodAnnotationFactory;\r\n"}}
