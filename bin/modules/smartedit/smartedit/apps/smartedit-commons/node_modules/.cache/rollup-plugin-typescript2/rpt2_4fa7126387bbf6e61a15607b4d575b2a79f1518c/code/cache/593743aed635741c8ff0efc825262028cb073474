{"code":"/*\r\n * Copyright (c) 2021 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { functionsUtils } from '@smart/utils';\r\nimport * as lodash from 'lodash';\r\n/**\r\n * The Message Gateway is a private channel that is used to publish and subscribe to events across iFrame\r\n * boundaries. The gateway uses the W3C-compliant postMessage as its underlying technology. The benefits of\r\n * the postMessage are that:\r\n *\r\n *      <ul>\r\n *          <li>It works in cross-origin scenarios.</li>\r\n *          <li>The receiving end can reject messages based on their origins.</li>\r\n *      </ul>\r\n *\r\n * The creation of instances is controlled by the {@link GatewayFactory}.\r\n * Only one instance can exist for each gateway ID.\r\n *\r\n */\r\nvar MessageGateway = /** @class */ (function () {\r\n    /**\r\n     * @param gatewayId The channel identifier\r\n     */\r\n    function MessageGateway(logService, systemEventService, cloneableUtils, windowUtils, promiseUtils, TIMEOUT_TO_RETRY_PUBLISHING, gatewayId) {\r\n        this.logService = logService;\r\n        this.systemEventService = systemEventService;\r\n        this.cloneableUtils = cloneableUtils;\r\n        this.windowUtils = windowUtils;\r\n        this.promiseUtils = promiseUtils;\r\n        this.TIMEOUT_TO_RETRY_PUBLISHING = TIMEOUT_TO_RETRY_PUBLISHING;\r\n        this.gatewayId = gatewayId;\r\n        this.PROMISE_ACKNOWLEDGEMENT_EVENT_ID = 'promiseAcknowledgement';\r\n        this.PROMISE_RETURN_EVENT_ID = 'promiseReturn';\r\n        this.SUCCESS = 'success';\r\n        this.FAILURE = 'failure';\r\n        this.MAX_RETRIES = 5;\r\n        this.promisesToResolve = {};\r\n    }\r\n    /**\r\n     * Publishes a message across the gateway using the postMessage.\r\n     *\r\n     * The gateway's publish method implements promises, which are an AngularJS implementation. To resolve a\r\n     * publish promise, all listener promises on the side of the channel must resolve. If a failure occurs in the\r\n     * chain, the chain is interrupted and the publish promise is rejected.\r\n     *\r\n     * @param data Message payload\r\n     * @param retries The current number of attempts to publish a message. By default it is 0.\r\n     * @param pk An optional parameter. It is a primary key for the event, which is generated after\r\n     * the first attempt to send a message.\r\n     */\r\n    MessageGateway.prototype.publish = function (eventId, _data, retries, pk) {\r\n        var _this = this;\r\n        if (retries === void 0) { retries = 0; }\r\n        if (!eventId) {\r\n            return Promise.reject(\"MessageGateway: Failed to send event. No event ID provided for _data: \" + _data);\r\n        }\r\n        var data = this.cloneableUtils.makeCloneable(_data);\r\n        if (!lodash.isEqual(data, _data)) {\r\n            this.logService.debug(\"MessageGateway.publish - Non cloneable payload has been sanitized for gateway \" + this.gatewayId + \", event \" + eventId + \":\", data);\r\n        }\r\n        var deferred = this.promisesToResolve[pk] ||\r\n            this.promiseUtils.defer();\r\n        try {\r\n            var target = this.windowUtils.getGatewayTargetFrame();\r\n            if (!target) {\r\n                deferred.reject('It is standalone. There is no iframe');\r\n                return deferred.promise;\r\n            }\r\n            pk = pk || this._generateIdentifier();\r\n            try {\r\n                target.postMessage({\r\n                    pk: pk,\r\n                    gatewayId: this.gatewayId,\r\n                    eventId: eventId,\r\n                    data: data\r\n                }, '*');\r\n            }\r\n            catch (e) {\r\n                this.logService.error(e);\r\n                this.logService.error(\"MessageGateway.publish - postMessage has failed for gateway \" + this.gatewayId + \" event \" + eventId + \" and data \", data);\r\n            }\r\n            this.promisesToResolve[pk] = deferred;\r\n            // in case promise does not return because, say, a non ready frame\r\n            this._setTimeout(function () {\r\n                if (!deferred.acknowledged &&\r\n                    eventId !== _this.PROMISE_RETURN_EVENT_ID &&\r\n                    eventId !== _this.PROMISE_ACKNOWLEDGEMENT_EVENT_ID) {\r\n                    // still pending\r\n                    if (retries < _this.MAX_RETRIES) {\r\n                        _this.logService.debug(document.location.href + \" is retrying to publish event \" + eventId);\r\n                        _this.publish(eventId, data, ++retries, pk).catch(function (reason) {\r\n                            //\r\n                        });\r\n                    }\r\n                    else {\r\n                        var error = \"MessageGateway.publish - Not able to publish event \" + eventId + \" after max retries for gateway \" + _this.gatewayId + \" and data\";\r\n                        deferred.reject({ error: error, data: data });\r\n                    }\r\n                }\r\n            }, this.TIMEOUT_TO_RETRY_PUBLISHING);\r\n        }\r\n        catch (e) {\r\n            deferred.reject();\r\n        }\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * Registers a given callback function to the given event ID.\r\n     *\r\n     * @param callback Callback function to be invoked\r\n     * @returns The function to call in order to unsubscribe the event listening\r\n     */\r\n    MessageGateway.prototype.subscribe = function (eventId, callback) {\r\n        var unsubscribeFn;\r\n        if (!eventId) {\r\n            this.logService.error('MessageGateway: Failed to subscribe event handler for event: ' + eventId);\r\n        }\r\n        else {\r\n            var systemEventId = this._getSystemEventId(eventId);\r\n            unsubscribeFn = this.systemEventService.subscribe(systemEventId, callback);\r\n        }\r\n        return unsubscribeFn;\r\n    };\r\n    MessageGateway.prototype.processEvent = function (event) {\r\n        var _this = this;\r\n        var eventData = event.data;\r\n        if (event.eventId !== this.PROMISE_RETURN_EVENT_ID &&\r\n            event.eventId !== this.PROMISE_ACKNOWLEDGEMENT_EVENT_ID) {\r\n            this.logService.debug(document.location.href, 'sending acknowledgement for', event);\r\n            this.publish(this.PROMISE_ACKNOWLEDGEMENT_EVENT_ID, {\r\n                pk: event.pk\r\n            });\r\n            var systemEventId = this._getSystemEventId(event.eventId);\r\n            return this.systemEventService.publishAsync(systemEventId, event.data).then(function (resolvedDataOfLastSubscriber) {\r\n                _this.logService.debug(document.location.href, 'sending promise resolve', event);\r\n                return _this.publish(_this.PROMISE_RETURN_EVENT_ID, {\r\n                    pk: event.pk,\r\n                    type: _this.SUCCESS,\r\n                    resolvedDataOfLastSubscriber: resolvedDataOfLastSubscriber\r\n                });\r\n            }, function () {\r\n                _this.logService.debug(document.location.href, 'sending promise reject', event);\r\n                return _this.publish(_this.PROMISE_RETURN_EVENT_ID, {\r\n                    pk: event.pk,\r\n                    type: _this.FAILURE\r\n                });\r\n            });\r\n        }\r\n        else if (event.eventId === this.PROMISE_RETURN_EVENT_ID) {\r\n            if (this.promisesToResolve[eventData.pk]) {\r\n                if (eventData.type === this.SUCCESS) {\r\n                    this.logService.debug(document.location.href, 'received promise resolve', event);\r\n                    this.promisesToResolve[eventData.pk].resolve(eventData.resolvedDataOfLastSubscriber);\r\n                }\r\n                else if (eventData.type === this.FAILURE) {\r\n                    this.logService.debug(document.location.href, 'received promise reject', event);\r\n                    this.promisesToResolve[eventData.pk].reject();\r\n                }\r\n                delete this.promisesToResolve[eventData.pk];\r\n            }\r\n        }\r\n        else if (event.eventId === this.PROMISE_ACKNOWLEDGEMENT_EVENT_ID) {\r\n            if (this.promisesToResolve[eventData.pk]) {\r\n                this.logService.debug(document.location.href, 'received acknowledgement', event);\r\n                this.promisesToResolve[eventData.pk].acknowledged = true;\r\n            }\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    MessageGateway.prototype._setTimeout = function (callback, timeout) {\r\n        if (functionsUtils.isUnitTestMode()) {\r\n            setTimeout(callback, timeout);\r\n        }\r\n        else {\r\n            this.windowUtils.runTimeoutOutsideAngular(callback, timeout);\r\n        }\r\n    };\r\n    MessageGateway.prototype._generateIdentifier = function () {\r\n        return new Date().getTime() + Math.random().toString();\r\n    };\r\n    MessageGateway.prototype._getSystemEventId = function (eventId) {\r\n        return this.gatewayId + ':' + eventId;\r\n    };\r\n    return MessageGateway;\r\n}());\r\nexport { MessageGateway };\r\n//# sourceMappingURL=MessageGateway.js.map","references":["/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/dist/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@types/lodash@4.14.159/node_modules/@types/lodash/ts3.1/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/utils/index.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/services/SystemEventService.ts"],"map":"{\"version\":3,\"file\":\"MessageGateway.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/services/gateway/MessageGateway.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/services/gateway/MessageGateway.d.ts","writeByteOrderMark":false,"text":"import { Cloneable, CloneableEventHandler, CloneableUtils, LogService, Payload, PromiseUtils } from '@smart/utils';\r\nimport { WindowUtils } from 'smarteditcommons/utils';\r\nimport { SystemEventService } from '../SystemEventService';\r\nexport interface IGatewayPostMessageData extends Payload {\r\n    pk: string;\r\n    gatewayId: string;\r\n    eventId: string;\r\n    data: Cloneable;\r\n}\r\n/**\r\n * The Message Gateway is a private channel that is used to publish and subscribe to events across iFrame\r\n * boundaries. The gateway uses the W3C-compliant postMessage as its underlying technology. The benefits of\r\n * the postMessage are that:\r\n *\r\n *      <ul>\r\n *          <li>It works in cross-origin scenarios.</li>\r\n *          <li>The receiving end can reject messages based on their origins.</li>\r\n *      </ul>\r\n *\r\n * The creation of instances is controlled by the {@link GatewayFactory}.\r\n * Only one instance can exist for each gateway ID.\r\n *\r\n */\r\nexport declare class MessageGateway {\r\n    private logService;\r\n    private systemEventService;\r\n    private cloneableUtils;\r\n    private windowUtils;\r\n    private promiseUtils;\r\n    private TIMEOUT_TO_RETRY_PUBLISHING;\r\n    readonly gatewayId: string;\r\n    private PROMISE_ACKNOWLEDGEMENT_EVENT_ID;\r\n    private PROMISE_RETURN_EVENT_ID;\r\n    private SUCCESS;\r\n    private FAILURE;\r\n    private MAX_RETRIES;\r\n    private promisesToResolve;\r\n    /**\r\n     * @param gatewayId The channel identifier\r\n     */\r\n    constructor(logService: LogService, systemEventService: SystemEventService, cloneableUtils: CloneableUtils, windowUtils: WindowUtils, promiseUtils: PromiseUtils, TIMEOUT_TO_RETRY_PUBLISHING: number, gatewayId: string);\r\n    /**\r\n     * Publishes a message across the gateway using the postMessage.\r\n     *\r\n     * The gateway's publish method implements promises, which are an AngularJS implementation. To resolve a\r\n     * publish promise, all listener promises on the side of the channel must resolve. If a failure occurs in the\r\n     * chain, the chain is interrupted and the publish promise is rejected.\r\n     *\r\n     * @param data Message payload\r\n     * @param retries The current number of attempts to publish a message. By default it is 0.\r\n     * @param pk An optional parameter. It is a primary key for the event, which is generated after\r\n     * the first attempt to send a message.\r\n     */\r\n    publish<Tin extends Cloneable, Tout extends Cloneable>(eventId: string, _data: Tin, retries?: number, pk?: string): Promise<void | Tout>;\r\n    /**\r\n     * Registers a given callback function to the given event ID.\r\n     *\r\n     * @param callback Callback function to be invoked\r\n     * @returns The function to call in order to unsubscribe the event listening\r\n     */\r\n    subscribe<T extends Cloneable>(eventId: string, callback: CloneableEventHandler<T>): () => void;\r\n    processEvent(event: IGatewayPostMessageData): Promise<any>;\r\n    private _setTimeout;\r\n    private _generateIdentifier;\r\n    private _getSystemEventId;\r\n}\r\n"}}
