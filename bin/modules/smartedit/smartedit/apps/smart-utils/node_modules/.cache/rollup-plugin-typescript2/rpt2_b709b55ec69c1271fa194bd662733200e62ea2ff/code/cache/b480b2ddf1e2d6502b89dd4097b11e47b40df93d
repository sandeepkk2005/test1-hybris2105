{"code":"import { __decorate, __metadata, __param } from \"tslib\";\r\n/*\r\n * Copyright (c) 2021 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\n/**\r\n * Copyright (c) 2019 SAP SE or an SAP affiliate company. All rights reserved.\r\n * @module smartutils\r\n */\r\nimport { HttpResponse } from '@angular/common/http';\r\nimport { Inject, Injectable, Injector } from '@angular/core';\r\nimport { from, Observable } from 'rxjs';\r\nimport { switchMap } from 'rxjs/operators';\r\nimport { I18N_RESOURCE_URI_TOKEN } from '../../constants';\r\nimport { IAuthenticationService, IStorageService } from '../../interfaces';\r\nimport { HttpUtils } from '../../utils';\r\nimport { GET_REQUESTS_ON_HOLD_MAP } from './errors/unauthorized-error.interceptor';\r\n/**\r\n * @ngdoc service\r\n * @name @smartutils.httpAuthInterceptor\r\n *\r\n * @description\r\n * Makes it possible to perform global authentication by intercepting requests before they are forwarded to the server\r\n * and responses before they are forwarded to the application code.\r\n *\r\n */\r\nvar HttpAuthInterceptor = /** @class */ (function () {\r\n    function HttpAuthInterceptor(authenticationService, injector, httpUtils, I18N_RESOURCE_URI) {\r\n        this.authenticationService = authenticationService;\r\n        this.injector = injector;\r\n        this.httpUtils = httpUtils;\r\n        this.I18N_RESOURCE_URI = I18N_RESOURCE_URI;\r\n    }\r\n    /**\r\n     * @ngdoc method\r\n     * @name @smartutils.httpAuthInterceptor#request\r\n     * @methodOf @smartutils.httpAuthInterceptor\r\n     *\r\n     * @description\r\n     * Interceptor method which gets called with a http config object, intercepts any request made using httpClient service.\r\n     * A call to any REST resource will be intercepted by this method, which then adds an authentication token to the request\r\n     * and then forwards it to the REST resource.\r\n     *\r\n     */\r\n    HttpAuthInterceptor.prototype.intercept = function (request, next) {\r\n        var _this = this;\r\n        if (!request.url.includes(this.I18N_RESOURCE_URI) &&\r\n            this.httpUtils.isCRUDRequest(request)) {\r\n            if (this.httpUtils.isGET(request) && GET_REQUESTS_ON_HOLD_MAP[request.url]) {\r\n                return new Observable(function (obj) {\r\n                    GET_REQUESTS_ON_HOLD_MAP[request.url].then(function (body) {\r\n                        obj.next(new HttpResponse({ status: 200, body: body }));\r\n                    });\r\n                });\r\n            }\r\n            return from(this.authenticationService.filterEntryPoints(request.url)).pipe(switchMap(function (entryPoints) {\r\n                if (entryPoints && entryPoints.length) {\r\n                    return from(_this.injector.get(IStorageService).getAuthToken(entryPoints[0])).pipe(switchMap(function (authToken) {\r\n                        if (authToken) {\r\n                            var authReq = request.clone({\r\n                                headers: request.headers.set('Authorization', authToken.token_type + ' ' + authToken.access_token)\r\n                            });\r\n                            return next.handle(authReq);\r\n                        }\r\n                        else {\r\n                            return next.handle(request);\r\n                        }\r\n                    }));\r\n                }\r\n                else {\r\n                    return next.handle(request);\r\n                }\r\n            }));\r\n        }\r\n        else {\r\n            return next.handle(request);\r\n        }\r\n    };\r\n    HttpAuthInterceptor = __decorate([\r\n        Injectable(),\r\n        __param(3, Inject(I18N_RESOURCE_URI_TOKEN)),\r\n        __metadata(\"design:paramtypes\", [IAuthenticationService,\r\n            Injector,\r\n            HttpUtils, String])\r\n    ], HttpAuthInterceptor);\r\n    return HttpAuthInterceptor;\r\n}());\r\nexport { HttpAuthInterceptor };\r\n//# sourceMappingURL=http-auth.interceptor.js.map","references":["/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular/common@8.2.14_@angular+core@8.2.14+rxjs@6.5.4/node_modules/@angular/common/http.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular/core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/rxjs@6.5.4/node_modules/rxjs/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/rxjs@6.5.4/node_modules/rxjs/operators/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/src/constants.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/src/interfaces/index.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/src/utils/index.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/src/services/interceptors/errors/unauthorized-error.interceptor.ts"],"map":"{\"version\":3,\"file\":\"http-auth.interceptor.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/services/interceptors/http-auth.interceptor.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/services/interceptors/http-auth.interceptor.d.ts","writeByteOrderMark":false,"text":"/**\r\n * Copyright (c) 2019 SAP SE or an SAP affiliate company. All rights reserved.\r\n * @module smartutils\r\n */\r\nimport { HttpEvent, HttpHandler, HttpInterceptor, HttpRequest } from '@angular/common/http';\r\nimport { Injector } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { IAuthenticationService } from '../../interfaces';\r\nimport { HttpUtils } from '../../utils';\r\n/**\r\n * @ngdoc service\r\n * @name @smartutils.httpAuthInterceptor\r\n *\r\n * @description\r\n * Makes it possible to perform global authentication by intercepting requests before they are forwarded to the server\r\n * and responses before they are forwarded to the application code.\r\n *\r\n */\r\nexport declare class HttpAuthInterceptor implements HttpInterceptor {\r\n    private authenticationService;\r\n    private injector;\r\n    private httpUtils;\r\n    private I18N_RESOURCE_URI;\r\n    constructor(authenticationService: IAuthenticationService, injector: Injector, httpUtils: HttpUtils, I18N_RESOURCE_URI: string);\r\n    /**\r\n     * @ngdoc method\r\n     * @name @smartutils.httpAuthInterceptor#request\r\n     * @methodOf @smartutils.httpAuthInterceptor\r\n     *\r\n     * @description\r\n     * Interceptor method which gets called with a http config object, intercepts any request made using httpClient service.\r\n     * A call to any REST resource will be intercepted by this method, which then adds an authentication token to the request\r\n     * and then forwards it to the REST resource.\r\n     *\r\n     */\r\n    intercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>>;\r\n}\r\n"}}
