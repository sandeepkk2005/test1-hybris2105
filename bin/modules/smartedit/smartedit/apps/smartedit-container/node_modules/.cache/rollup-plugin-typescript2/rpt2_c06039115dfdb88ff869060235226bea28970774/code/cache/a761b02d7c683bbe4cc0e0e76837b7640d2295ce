{"code":"import { __decorate, __extends, __metadata } from \"tslib\";\r\n/*\r\n * Copyright (c) 2021 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { Injectable } from '@angular/core';\r\nimport * as lodash from 'lodash';\r\nimport { CryptographicUtils, FingerPrintingService, GatewayProxied, IStorageService, LogService, SeDowngradeService, WindowUtils } from 'smarteditcommons';\r\n/** @internal */\r\nvar /* @ngInject */ StorageService = /** @class */ (function (_super) {\r\n    __extends(/* @ngInject */ StorageService, _super);\r\n    function /* @ngInject */ StorageService(logService, windowUtils, cryptographicUtils, fingerPrintingService) {\r\n        var _this = _super.call(this) || this;\r\n        _this.logService = logService;\r\n        _this.windowUtils = windowUtils;\r\n        _this.cryptographicUtils = cryptographicUtils;\r\n        _this.fingerPrintingService = fingerPrintingService;\r\n        _this.SMARTEDIT_SESSIONS = 'smartedit-sessions';\r\n        _this.CUSTOM_PROPERTIES = 'custom_properties';\r\n        return _this;\r\n    }\r\n    /* @ngInject */ StorageService.prototype.isInitialized = function () {\r\n        var sessions = this.getAuthTokens();\r\n        return Promise.resolve(lodash.values(lodash.omit(sessions, [this.CUSTOM_PROPERTIES])).length > 0);\r\n    };\r\n    /* @ngInject */ StorageService.prototype.storeAuthToken = function (authURI, auth) {\r\n        var sessions = this.getAuthTokens();\r\n        sessions[authURI] = auth;\r\n        this._setSmarteditSessions(sessions);\r\n        return Promise.resolve();\r\n    };\r\n    /* @ngInject */ StorageService.prototype.getAuthToken = function (authURI) {\r\n        var sessions = this.getAuthTokens();\r\n        return Promise.resolve(sessions[authURI]);\r\n    };\r\n    /* @ngInject */ StorageService.prototype.removeAuthToken = function (authURI) {\r\n        var sessions = this.getAuthTokens();\r\n        delete sessions[authURI];\r\n        this._setSmarteditSessions(sessions);\r\n        return Promise.resolve();\r\n    };\r\n    /* @ngInject */ StorageService.prototype.removeAllAuthTokens = function () {\r\n        this._removeAllAuthTokens();\r\n        return Promise.resolve();\r\n    };\r\n    /* @ngInject */ StorageService.prototype.getValueFromCookie = function (cookieName, isEncoded) {\r\n        throw new Error('getValueFromCookie deprecated since 1905, use getValueFromLocalStorage');\r\n    };\r\n    /* @ngInject */ StorageService.prototype.getValueFromLocalStorage = function (cookieName, isEncoded) {\r\n        return Promise.resolve(this._getValueFromLocalStorage(cookieName, isEncoded));\r\n    };\r\n    /* @ngInject */ StorageService.prototype.getAuthTokens = function () {\r\n        var smarteditSessions = this.windowUtils\r\n            .getWindow()\r\n            .localStorage.getItem(this.SMARTEDIT_SESSIONS);\r\n        var authTokens;\r\n        if (smarteditSessions) {\r\n            try {\r\n                var decrypted = this.cryptographicUtils.aesDecrypt(smarteditSessions, this.fingerPrintingService.getFingerprint());\r\n                authTokens = JSON.parse(decodeURIComponent(escape(decrypted)));\r\n            }\r\n            catch (_a) {\r\n                // failed to decrypt token. may occur if fingerprint changed.\r\n                this.logService.info('Failed to read authentication token. Forcing a re-authentication.');\r\n            }\r\n        }\r\n        return authTokens || {};\r\n    };\r\n    /* @ngInject */ StorageService.prototype.putValueInCookie = function (cookieName, value, encode) {\r\n        throw new Error('putValueInCookie deprecated since 1905, use setValueInLocalStorage');\r\n    };\r\n    /* @ngInject */ StorageService.prototype.setValueInLocalStorage = function (cookieName, value, encode) {\r\n        return Promise.resolve(this._setValueInLocalStorage(cookieName, value, encode));\r\n    };\r\n    /* @ngInject */ StorageService.prototype.setItem = function (key, value) {\r\n        var sessions = this.getAuthTokens();\r\n        sessions[this.CUSTOM_PROPERTIES] = sessions[this.CUSTOM_PROPERTIES] || {};\r\n        sessions[this.CUSTOM_PROPERTIES][key] = value;\r\n        this._setSmarteditSessions(sessions);\r\n        return Promise.resolve();\r\n    };\r\n    /* @ngInject */ StorageService.prototype.getItem = function (key) {\r\n        var sessions = this.getAuthTokens();\r\n        sessions[this.CUSTOM_PROPERTIES] = sessions[this.CUSTOM_PROPERTIES] || {};\r\n        return Promise.resolve(sessions[this.CUSTOM_PROPERTIES][key]);\r\n    };\r\n    /* @ngInject */ StorageService.prototype._removeAllAuthTokens = function () {\r\n        var sessions = this.getAuthTokens();\r\n        var newSessions = lodash.pick(sessions, [this.CUSTOM_PROPERTIES]);\r\n        this._setSmarteditSessions(newSessions);\r\n    };\r\n    /* @ngInject */ StorageService.prototype._getValueFromLocalStorage = function (cookieName, isEncoded) {\r\n        var rawValue = this.windowUtils.getWindow().localStorage.getItem(cookieName);\r\n        var value = null;\r\n        if (rawValue) {\r\n            try {\r\n                value = JSON.parse(isEncoded ? decodeURIComponent(escape(window.atob(rawValue))) : rawValue);\r\n            }\r\n            catch (e) {\r\n                // protecting against deserialization issue\r\n                this.logService.error('Failed during deserialization ', e);\r\n            }\r\n        }\r\n        return value;\r\n    };\r\n    /* @ngInject */ StorageService.prototype._setSmarteditSessions = function (sessions) {\r\n        var sessionsJSONString = btoa(unescape(encodeURIComponent(JSON.stringify(sessions))));\r\n        var sessionsEncrypted = this.cryptographicUtils.aesBase64Encrypt(sessionsJSONString, this.fingerPrintingService.getFingerprint());\r\n        this.windowUtils\r\n            .getWindow()\r\n            .localStorage.setItem(this.SMARTEDIT_SESSIONS, sessionsEncrypted);\r\n    };\r\n    /* @ngInject */ StorageService.prototype._setValueInLocalStorage = function (cookieName, value, encode) {\r\n        var processedValue = JSON.stringify(value);\r\n        processedValue = encode\r\n            ? btoa(unescape(encodeURIComponent(processedValue)))\r\n            : processedValue;\r\n        this.windowUtils.getWindow().localStorage.setItem(cookieName, processedValue);\r\n    };\r\n    /* @ngInject */ StorageService = __decorate([\r\n        SeDowngradeService(IStorageService),\r\n        GatewayProxied('isInitialized', 'storeAuthToken', 'getAuthToken', 'removeAuthToken', 'removeAllAuthTokens', 'storePrincipalIdentifier', 'getPrincipalIdentifier', 'removePrincipalIdentifier', 'getValueFromCookie', 'getValueFromLocalStorage'),\r\n        Injectable(),\r\n        __metadata(\"design:paramtypes\", [LogService,\r\n            WindowUtils,\r\n            CryptographicUtils,\r\n            FingerPrintingService])\r\n    ], /* @ngInject */ StorageService);\r\n    return /* @ngInject */ StorageService;\r\n}(IStorageService));\r\nexport { /* @ngInject */ StorageService };\r\n//# sourceMappingURL=StorageServiceOuter.js.map","references":["/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular/core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@types/lodash@4.14.159/node_modules/@types/lodash/ts3.1/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts"],"map":"{\"version\":3,\"file\":\"StorageServiceOuter.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/services/StorageServiceOuter.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-container/services/StorageServiceOuter.d.ts","writeByteOrderMark":false,"text":"import { CryptographicUtils, FingerPrintingService, IAuthToken, IStorageService, LogService, WindowUtils } from 'smarteditcommons';\r\nexport interface ISessionAuth {\r\n    [index: string]: IAuthToken | any;\r\n}\r\n/** @internal */\r\nexport declare class StorageService extends IStorageService {\r\n    private logService;\r\n    private windowUtils;\r\n    private cryptographicUtils;\r\n    private fingerPrintingService;\r\n    private SMARTEDIT_SESSIONS;\r\n    private CUSTOM_PROPERTIES;\r\n    constructor(logService: LogService, windowUtils: WindowUtils, cryptographicUtils: CryptographicUtils, fingerPrintingService: FingerPrintingService);\r\n    isInitialized(): Promise<boolean>;\r\n    storeAuthToken(authURI: string, auth: IAuthToken): Promise<void>;\r\n    getAuthToken(authURI: string): Promise<IAuthToken>;\r\n    removeAuthToken(authURI: string): Promise<void>;\r\n    removeAllAuthTokens(): Promise<void>;\r\n    getValueFromCookie(cookieName: string, isEncoded: boolean): Promise<any>;\r\n    getValueFromLocalStorage(cookieName: string, isEncoded: boolean): Promise<any>;\r\n    getAuthTokens(): ISessionAuth;\r\n    putValueInCookie(cookieName: string, value: any, encode: boolean): void;\r\n    setValueInLocalStorage(cookieName: string, value: any, encode: boolean): Promise<void>;\r\n    setItem(key: string, value: any): Promise<void>;\r\n    getItem(key: string): Promise<any>;\r\n    private _removeAllAuthTokens;\r\n    private _getValueFromLocalStorage;\r\n    private _setSmarteditSessions;\r\n    private _setValueInLocalStorage;\r\n}\r\n"}}
