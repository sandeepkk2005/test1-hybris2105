{"code":"import { __decorate, __metadata } from \"tslib\";\r\n/*\r\n * Copyright (c) 2021 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { difference, concat } from 'lodash';\r\nimport { CrossFrameEventService, EVENTS, EVENT_CONTENT_CATALOG_UPDATE, GENERIC_EDITOR_UNRELATED_VALIDATION_MESSAGES_EVENT, IAlertService, IConfirmationModalService, SeDowngradeService } from 'smarteditcommons';\r\nimport { PageRestoredAlertService } from '../../actionableAlert';\r\nimport { GenericEditorModalService } from '../../GenericEditorModalService';\r\nimport { ACTIONABLE_ERRORS, NON_ACTIONABLE_ERRORS } from './PageRestoreModalConstants';\r\nvar /* @ngInject */ PageRestoreModalService = /** @class */ (function () {\r\n    function /* @ngInject */ PageRestoreModalService(alertService, confirmationModalService, genericEditorModalService, crossFrameEventService, pageRestoredAlertService, translate) {\r\n        this.alertService = alertService;\r\n        this.confirmationModalService = confirmationModalService;\r\n        this.genericEditorModalService = genericEditorModalService;\r\n        this.crossFrameEventService = crossFrameEventService;\r\n        this.pageRestoredAlertService = pageRestoredAlertService;\r\n        this.translate = translate;\r\n    }\r\n    /**\r\n     * Handles validation errors depending of their type - show error alert for unsupported errors,\r\n     * show confirmation message for non actionable errors, otherwise show modal with detailed errors\r\n     */\r\n    /* @ngInject */ PageRestoreModalService.prototype.handleRestoreValidationErrors = function (pageInfo, errors) {\r\n        var _this = this;\r\n        var actionableErrors = this.getActionableErrors(errors);\r\n        var nonActionableErrors = this.getNonActionableError(errors);\r\n        var unsupportedErrors = difference(errors, actionableErrors, nonActionableErrors);\r\n        if (unsupportedErrors.length > 0) {\r\n            this.showErrorAlert(unsupportedErrors);\r\n        }\r\n        else if (nonActionableErrors.length > 0) {\r\n            this.showConfirmationMessage(nonActionableErrors);\r\n        }\r\n        else {\r\n            this.showRestoreEditor(pageInfo, actionableErrors).then(function () {\r\n                _this.crossFrameEventService.publish(EVENT_CONTENT_CATALOG_UPDATE);\r\n            });\r\n        }\r\n    };\r\n    /* @ngInject */ PageRestoreModalService.prototype.showRestoreEditor = function (pageInfo, errors) {\r\n        var _this = this;\r\n        var structureFields = this.getRestoreEditorStructureFields(errors);\r\n        var editorData = {\r\n            content: pageInfo,\r\n            title: 'se.cms.page.restore.page.title',\r\n            componentId: pageInfo.uid,\r\n            componentUuid: pageInfo.uuid,\r\n            componentType: pageInfo.typeCode,\r\n            structure: this.buildStructure(structureFields)\r\n        };\r\n        this.forceErrorsDisplayInEditor(pageInfo.componentUuid, errors);\r\n        return this.genericEditorModalService.open(editorData, function () {\r\n            _this.pageRestoredAlertService.displayPageRestoredSuccessAlert(pageInfo);\r\n            _this.crossFrameEventService.publish(EVENTS.PAGE_RESTORED);\r\n        }, function (newErrors, ge) {\r\n            var actionableErrors = _this.getActionableErrors(newErrors);\r\n            var unsupportedErrors = difference(newErrors, actionableErrors);\r\n            if (unsupportedErrors.length > 0) {\r\n                _this.showErrorAlert(unsupportedErrors);\r\n            }\r\n            else {\r\n                structureFields = concat(structureFields, _this.getRestoreEditorStructureFields(newErrors));\r\n                ge.structure = _this.buildStructure(structureFields);\r\n                _this.forceErrorsDisplayInEditor(pageInfo.componentUuid, newErrors);\r\n            }\r\n        }, {\r\n            modalPanelClass: 'modal-stretched'\r\n        });\r\n    };\r\n    /* @ngInject */ PageRestoreModalService.prototype.forceErrorsDisplayInEditor = function (editorId, errors) {\r\n        var _this = this;\r\n        setTimeout(function () {\r\n            _this.crossFrameEventService.publish(GENERIC_EDITOR_UNRELATED_VALIDATION_MESSAGES_EVENT, {\r\n                messages: errors,\r\n                targetGenericEditorId: editorId\r\n            });\r\n        }, 0);\r\n    };\r\n    /* @ngInject */ PageRestoreModalService.prototype.buildStructure = function (structureFields) {\r\n        return {\r\n            attributes: structureFields,\r\n            category: 'PAGE'\r\n        };\r\n    };\r\n    /* @ngInject */ PageRestoreModalService.prototype.getRestoreEditorStructureFields = function (errors) {\r\n        var _this = this;\r\n        return errors.reduce(function (accumulator, currentError) {\r\n            var errorMapping = ACTIONABLE_ERRORS.find(function (actionableErrorMapping) {\r\n                return _this.isSupportedError(currentError) &&\r\n                    _this.isEqualTo(currentError, actionableErrorMapping);\r\n            });\r\n            accumulator.push(errorMapping.structure);\r\n            return accumulator;\r\n        }, []);\r\n    };\r\n    /* @ngInject */ PageRestoreModalService.prototype.showConfirmationMessage = function (errors) {\r\n        var _this = this;\r\n        var message = errors.reduce(function (accumulator, currentError) {\r\n            var errorMapping = NON_ACTIONABLE_ERRORS.find(function (nonActionableErrorMapping) {\r\n                return _this.isSupportedError(currentError) &&\r\n                    _this.isEqualTo(currentError, nonActionableErrorMapping);\r\n            });\r\n            return accumulator + _this.translate.instant(errorMapping.messageKey) + ' ';\r\n        }, '');\r\n        var modalConfig = {};\r\n        modalConfig.description = message.trim();\r\n        modalConfig.showOkButtonOnly = true;\r\n        modalConfig.title = 'se.cms.page.restore.error.confirmationmodal.title';\r\n        this.confirmationModalService.confirm(modalConfig);\r\n    };\r\n    /* @ngInject */ PageRestoreModalService.prototype.showErrorAlert = function (errors) {\r\n        var errorMessage = errors.reduce(function (accumulator, currentError) { return accumulator + currentError.message + ' '; }, '');\r\n        this.alertService.showDanger(errorMessage.trim());\r\n    };\r\n    /* @ngInject */ PageRestoreModalService.prototype.getActionableErrors = function (errors) {\r\n        var _this = this;\r\n        return errors.filter(function (error) {\r\n            return ACTIONABLE_ERRORS.some(function (actionableErrorMapping) {\r\n                return _this.isSupportedError(error) && _this.isEqualTo(error, actionableErrorMapping);\r\n            });\r\n        });\r\n    };\r\n    /* @ngInject */ PageRestoreModalService.prototype.getNonActionableError = function (errors) {\r\n        var _this = this;\r\n        return errors.filter(function (error) {\r\n            return NON_ACTIONABLE_ERRORS.some(function (nonActionableErrorMapping) {\r\n                return _this.isSupportedError(error) && _this.isEqualTo(error, nonActionableErrorMapping);\r\n            });\r\n        });\r\n    };\r\n    /* @ngInject */ PageRestoreModalService.prototype.isSupportedError = function (error) {\r\n        return error.type === 'ValidationError';\r\n    };\r\n    /* @ngInject */ PageRestoreModalService.prototype.isEqualTo = function (error1, error2) {\r\n        return error1.subject === error2.subject && error1.errorCode === error2.errorCode;\r\n    };\r\n    /* @ngInject */ PageRestoreModalService = __decorate([\r\n        SeDowngradeService(),\r\n        __metadata(\"design:paramtypes\", [IAlertService,\r\n            IConfirmationModalService,\r\n            GenericEditorModalService,\r\n            CrossFrameEventService,\r\n            PageRestoredAlertService,\r\n            TranslateService])\r\n    ], /* @ngInject */ PageRestoreModalService);\r\n    return /* @ngInject */ PageRestoreModalService;\r\n}());\r\nexport { /* @ngInject */ PageRestoreModalService };\r\n//# sourceMappingURL=PageRestoreModalService.js.map","references":["/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@ngx-translate/core@11.0.1_@angular+core@8.2.14+rxjs@6.5.4/node_modules/@ngx-translate/core/ngx-translate-core.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-commons/dist/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@types/lodash@4.14.159/node_modules/@types/lodash/ts3.1/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/services/actionableAlert/index.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/services/components/GenericEditorModalComponent.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/services/GenericEditorModalService.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/services/pages/pageRestore/PageRestoreModalConstants.ts"],"map":"{\"version\":3,\"file\":\"PageRestoreModalService.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/services/pages/pageRestore/PageRestoreModalService.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/services/pages/pageRestore/PageRestoreModalService.d.ts","writeByteOrderMark":false,"text":"import { TranslateService } from '@ngx-translate/core';\r\nimport { ICMSPage } from 'cmscommons';\r\nimport { CrossFrameEventService, IAlertService, IConfirmationModalService, ValidationError } from 'smarteditcommons';\r\nimport { PageRestoredAlertService } from '../../actionableAlert';\r\nimport { GenericEditorModalService } from '../../GenericEditorModalService';\r\nexport declare class PageRestoreModalService {\r\n    private alertService;\r\n    private confirmationModalService;\r\n    private genericEditorModalService;\r\n    private crossFrameEventService;\r\n    private pageRestoredAlertService;\r\n    private translate;\r\n    constructor(alertService: IAlertService, confirmationModalService: IConfirmationModalService, genericEditorModalService: GenericEditorModalService, crossFrameEventService: CrossFrameEventService, pageRestoredAlertService: PageRestoredAlertService, translate: TranslateService);\r\n    /**\r\n     * Handles validation errors depending of their type - show error alert for unsupported errors,\r\n     * show confirmation message for non actionable errors, otherwise show modal with detailed errors\r\n     */\r\n    handleRestoreValidationErrors(pageInfo: ICMSPage, errors: ValidationError[]): void;\r\n    private showRestoreEditor;\r\n    private forceErrorsDisplayInEditor;\r\n    private buildStructure;\r\n    private getRestoreEditorStructureFields;\r\n    private showConfirmationMessage;\r\n    private showErrorAlert;\r\n    private getActionableErrors;\r\n    private getNonActionableError;\r\n    private isSupportedError;\r\n    private isEqualTo;\r\n}\r\n"}}
