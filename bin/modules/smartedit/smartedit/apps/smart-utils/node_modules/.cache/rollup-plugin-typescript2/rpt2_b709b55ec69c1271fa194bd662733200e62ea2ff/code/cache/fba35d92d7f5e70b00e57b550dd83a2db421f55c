{"code":"import { __awaiter, __decorate, __generator } from \"tslib\";\r\n/*\r\n * Copyright (c) 2021 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\n/**\r\n * Copyright (c) 2019 SAP SE or an SAP affiliate company. All rights reserved.\r\n * @module smartutils\r\n */\r\nimport { Injectable } from '@angular/core';\r\nimport * as lodash from 'lodash';\r\nimport { LogService } from '../services/log.service';\r\n/**\r\n * @ngdoc service\r\n * @name @smartutils.services:PromiseUtils\r\n *\r\n * @description\r\n * utility service around ES6 Promises.\r\n */\r\nvar PromiseUtils = /** @class */ (function () {\r\n    function PromiseUtils() {\r\n        var _this = this;\r\n        this.WAIT_TIMEOUT = 4;\r\n        this.FAILURE_TIMEOUT = 2000;\r\n        this.handlePromiseRejections = function (promise) {\r\n            var oldThen = promise.then;\r\n            var defaultFailureCallback = _this.defaultFailureCallback;\r\n            // eslint-disable-next-line @typescript-eslint/explicit-function-return-type\r\n            promise.then = function (successCallback, _failureCallback) {\r\n                var failureCallback = _failureCallback ? _failureCallback : defaultFailureCallback;\r\n                return oldThen.call(this, successCallback, failureCallback);\r\n            };\r\n            return promise;\r\n        };\r\n        this.defaultFailureCallback = function (error) {\r\n            if (undefined !== error && null !== error && 'canceled' !== error) {\r\n                if (lodash.isPlainObject(error)) {\r\n                    if (!_this.isAjaxError(error)) {\r\n                        PromiseUtils_1.logService.error(\"exception caught in promise: \" + JSON.stringify(error));\r\n                    }\r\n                }\r\n                else if (!lodash.isBoolean(error)) {\r\n                    PromiseUtils_1.logService.error(error);\r\n                }\r\n            }\r\n            PromiseUtils_1.logService.error(\"defaultFailureCallback:\", error);\r\n            return Promise.reject(error);\r\n        };\r\n    }\r\n    PromiseUtils_1 = PromiseUtils;\r\n    PromiseUtils.prototype.toPromise = function (method, context) {\r\n        return function () {\r\n            try {\r\n                return Promise.resolve(method.apply(context, Array.prototype.slice.call(arguments)));\r\n            }\r\n            catch (e) {\r\n                PromiseUtils_1.logService.error('execution of a method that was turned into a promise failed');\r\n                PromiseUtils_1.logService.error(e);\r\n                return Promise.reject(e);\r\n            }\r\n        };\r\n    };\r\n    PromiseUtils.prototype.promise = function (executor) {\r\n        return this.handlePromiseRejections(new Promise(executor));\r\n    };\r\n    PromiseUtils.prototype.defer = function () {\r\n        var pResolve;\r\n        var pReject;\r\n        var deferred = {\r\n            promise: this.promise(function (_resolve, _reject) {\r\n                pResolve = _resolve;\r\n                pReject = _reject;\r\n            }),\r\n            resolve: function (value) {\r\n                pResolve(value);\r\n            },\r\n            reject: function (reason) {\r\n                pReject(reason);\r\n            }\r\n        };\r\n        return deferred;\r\n    };\r\n    PromiseUtils.prototype.sleep = function (ms) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2 /*return*/, new Promise(function (resolve) { return setTimeout(resolve, ms); })];\r\n            });\r\n        });\r\n    };\r\n    PromiseUtils.prototype.isAjaxError = function (error) {\r\n        return error.hasOwnProperty('headers');\r\n    };\r\n    PromiseUtils.prototype.waitOnCondition = function (condition, callback, errorMessage, elapsedTime) {\r\n        var _this = this;\r\n        if (elapsedTime === void 0) { elapsedTime = 0; }\r\n        setTimeout(function () {\r\n            if (condition()) {\r\n                callback();\r\n            }\r\n            else if (elapsedTime < _this.FAILURE_TIMEOUT) {\r\n                _this.waitOnCondition(condition, callback, errorMessage, elapsedTime + _this.WAIT_TIMEOUT);\r\n            }\r\n            else {\r\n                throw new Error(\"PromiseUtils: \" + errorMessage);\r\n            }\r\n        }, this.WAIT_TIMEOUT);\r\n    };\r\n    PromiseUtils.prototype.resolveToCallbackWhenCondition = function (condition, callback, errorMessage) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                return [2 /*return*/, new Promise(function (resolve) {\r\n                        _this.waitOnCondition(condition, function () { return resolve(callback()); }, errorMessage ? errorMessage : 'condition for promise resolution was never met');\r\n                    })];\r\n            });\r\n        });\r\n    };\r\n    PromiseUtils.prototype.attempt = function (promise) {\r\n        return promise\r\n            .then(function (data) { return ({\r\n            error: null,\r\n            data: data\r\n        }); })\r\n            .catch(function (error) { return ({\r\n            error: error,\r\n            data: null\r\n        }); });\r\n    };\r\n    var PromiseUtils_1;\r\n    PromiseUtils.logService = new LogService();\r\n    PromiseUtils = PromiseUtils_1 = __decorate([\r\n        Injectable()\r\n    ], PromiseUtils);\r\n    return PromiseUtils;\r\n}());\r\nexport { PromiseUtils };\r\nexport var promiseUtils = new PromiseUtils();\r\n//# sourceMappingURL=promise-utils.js.map","references":["/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular/core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@types/lodash@4.14.159/node_modules/@types/lodash/ts3.1/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/src/services/log.service.ts"],"map":"{\"version\":3,\"file\":\"promise-utils.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/utils/promise-utils.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/utils/promise-utils.d.ts","writeByteOrderMark":false,"text":"import { LogService } from '../services/log.service';\r\nexport interface Deferred<T> {\r\n    promise: Promise<T>;\r\n    resolve: (value?: T) => void;\r\n    reject: (value?: any) => void;\r\n}\r\n/**\r\n * @ngdoc service\r\n * @name @smartutils.services:PromiseUtils\r\n *\r\n * @description\r\n * utility service around ES6 Promises.\r\n */\r\nexport declare class PromiseUtils {\r\n    static logService: LogService;\r\n    private WAIT_TIMEOUT;\r\n    private FAILURE_TIMEOUT;\r\n    toPromise<T>(method: (...args: any[]) => T, context?: any): (...innerArgs: any[]) => Promise<T>;\r\n    promise<T>(executor: (resolve: (value?: T | PromiseLike<T>) => void, reject: (reason?: any) => void) => void): Promise<T>;\r\n    defer<T>(): Deferred<T>;\r\n    sleep(ms: number): Promise<any>;\r\n    handlePromiseRejections: <T>(promise: Promise<T>) => Promise<T>;\r\n    isAjaxError(error: any): boolean;\r\n    waitOnCondition(condition: () => boolean, callback: () => any, errorMessage: string, elapsedTime?: number): void;\r\n    resolveToCallbackWhenCondition<T>(condition: () => boolean, callback: () => T, errorMessage?: string): Promise<T>;\r\n    attempt<T>(promise: Promise<T>): Promise<{\r\n        error: any;\r\n        data: T;\r\n    }>;\r\n    private defaultFailureCallback;\r\n}\r\nexport declare const promiseUtils: PromiseUtils;\r\n"}}
