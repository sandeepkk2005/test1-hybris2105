{"code":"import { __assign, __decorate, __metadata, __param } from \"tslib\";\r\nimport { Component, ElementRef, Inject, ViewChild } from '@angular/core';\r\nimport { SeDowngradeComponent } from 'smarteditcommons/di';\r\nimport { SettingsService } from 'smarteditcommons/services';\r\nimport { GENERIC_EDITOR_WIDGET_DATA } from '../../components/tokens';\r\nimport { GenericEditorSanitizationService } from './services/GenericEditorSanitizationService';\r\nimport { RichTextFieldLocalizationService } from './services/RichTextFieldLocalizationService';\r\nimport { RichTextLoaderService } from './services/RichTextLoaderService';\r\nimport { RICH_TEXT_CONFIGURATION } from './tokens';\r\nwindow.__smartedit__.addDecoratorPayload(\"Component\", \"RichTextFieldComponent\", {\r\n    selector: 'se-rich-text-field',\r\n    template: \"<textarea #textarea class=\\\"fd-form__control\\\" [ngClass]=\\\"{'has-error': widget.field.hasErrors}\\\" name=\\\"{{widget.field.qualifier}}-{{widget.qualifier}}\\\" [disabled]=\\\"widget.isFieldDisabled()\\\" [(ngModel)]=\\\"widget.model[widget.qualifier]\\\" (change)=\\\"reassignUserCheck()\\\"></textarea><div *ngIf=\\\"requiresUserCheck()\\\"><div id=\\\"richTextWarningMessage\\\" [hidden]=\\\"widget.field.isUserChecked\\\"><span fd-status-label [status]=\\\"'warning'\\\" [icon]=\\\"'message-warning'\\\">{{'se.editor.richtext.message.warning' | translate}}</span></div><input id=\\\"richTextWarningCheckBox\\\" type=\\\"checkbox\\\" [(ngModel)]=\\\"widget.field.isUserChecked\\\" (click)=\\\"checkboxOnClick($event.target)\\\"/> <span [ngClass]=\\\"{'warning-check-msg': true, 'not-checked': widget.editor.hasFrontEndValidationErrors && !widget.field.isUserChecked}\\\">{{'se.editor.richtext.check' | translate}}</span></div>\"\r\n});\r\nvar /* @ngInject */ RichTextFieldComponent = /** @class */ (function () {\r\n    function /* @ngInject */ RichTextFieldComponent(widget, seRichTextLoaderService, seRichTextConfiguration, genericEditorSanitizationService, seRichTextFieldLocalizationService, settingsService) {\r\n        this.widget = widget;\r\n        this.seRichTextLoaderService = seRichTextLoaderService;\r\n        this.seRichTextConfiguration = seRichTextConfiguration;\r\n        this.genericEditorSanitizationService = genericEditorSanitizationService;\r\n        this.seRichTextFieldLocalizationService = seRichTextFieldLocalizationService;\r\n        this.settingsService = settingsService;\r\n    }\r\n    /* @ngInject */ RichTextFieldComponent.prototype.ngAfterViewInit = function () {\r\n        var _this = this;\r\n        return this.settingsService\r\n            .get('cms.components.allowUnsafeJavaScript')\r\n            .then(function (allowUnsafeJavaScript) {\r\n            return _this.seRichTextLoaderService.load().then(function () {\r\n                _this.seRichTextConfiguration.allowedContent = allowUnsafeJavaScript === 'true';\r\n                _this.editorInstance = CKEDITOR.replace(_this.textarea.nativeElement, _this.seRichTextConfiguration);\r\n                _this.seRichTextFieldLocalizationService.localizeCKEditor();\r\n                if (_this.editorInstance) {\r\n                    _this.editorInstance.on('change', function () { return _this.onChange(); });\r\n                    _this.editorInstance.on('mode', function () { return _this.onMode(); });\r\n                    CKEDITOR.on('instanceReady', function (ev) { return _this.onInstanceReady(ev); });\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /* @ngInject */ RichTextFieldComponent.prototype.ngOnDestroy = function () {\r\n        if (this.editorInstance && CKEDITOR.instances[this.editorInstance.name]) {\r\n            CKEDITOR.instances[this.editorInstance.name].destroy();\r\n        }\r\n    };\r\n    /* @ngInject */ RichTextFieldComponent.prototype.onChange = function () {\r\n        var _this = this;\r\n        setTimeout(function () {\r\n            _this.widget.model[_this.widget.qualifier] = _this.editorInstance.getData();\r\n            _this.reassignUserCheck();\r\n            _this.toggleSubmitButton(_this.requiresUserCheck() && !_this.widget.field.isUserChecked);\r\n        });\r\n    };\r\n    /* @ngInject */ RichTextFieldComponent.prototype.onMode = function () {\r\n        var _this = this;\r\n        if (this.editorInstance.mode === 'source') {\r\n            var editable = this.editorInstance.editable();\r\n            editable.attachListener(editable, 'input', function () {\r\n                _this.editorInstance.fire('change');\r\n            });\r\n        }\r\n    };\r\n    /* @ngInject */ RichTextFieldComponent.prototype.onInstanceReady = function (ev) {\r\n        var tags = CKEDITOR.dtd;\r\n        var elements = __assign(__assign(__assign(__assign(__assign({}, tags.$nonBodyContent), tags.$block), tags.$listItem), tags.$tableContent), { br: 1 });\r\n        for (var _i = 0, _a = Object.keys(elements); _i < _a.length; _i++) {\r\n            var element = _a[_i];\r\n            ev.editor.dataProcessor.writer.setRules(element, {\r\n                indent: false,\r\n                breakBeforeOpen: false,\r\n                breakAfterOpen: false,\r\n                breakBeforeClose: false,\r\n                breakAfterClose: false\r\n            });\r\n        }\r\n        ev.editor.dataProcessor.writer.lineBreakChars = '';\r\n        ev.editor.dataProcessor.writer.indentationChars = '';\r\n    };\r\n    /* @ngInject */ RichTextFieldComponent.prototype.requiresUserCheck = function () {\r\n        var requiresUserCheck = false;\r\n        for (var qualifier in this.widget.field.requiresUserCheck) {\r\n            if (this.widget.field.requiresUserCheck.hasOwnProperty(qualifier)) {\r\n                requiresUserCheck =\r\n                    requiresUserCheck || this.widget.field.requiresUserCheck[qualifier];\r\n            }\r\n        }\r\n        return requiresUserCheck;\r\n    };\r\n    /* @ngInject */ RichTextFieldComponent.prototype.reassignUserCheck = function () {\r\n        if (this.widget.model &&\r\n            this.widget.qualifier &&\r\n            this.widget.model[this.widget.qualifier]) {\r\n            var sanitizedContentMatchesContent = this.genericEditorSanitizationService.isSanitized(this.widget.model[this.widget.qualifier]);\r\n            this.widget.field.requiresUserCheck = this.widget.field.requiresUserCheck || {};\r\n            this.widget.field.requiresUserCheck[this.widget.qualifier] = !sanitizedContentMatchesContent;\r\n        }\r\n        else {\r\n            this.widget.field.requiresUserCheck = this.widget.field.requiresUserCheck || {};\r\n            this.widget.field.requiresUserCheck[this.widget.qualifier] = false;\r\n        }\r\n    };\r\n    /* @ngInject */ RichTextFieldComponent.prototype.checkboxOnClick = function (event) {\r\n        this.toggleSubmitButton(!event.checked);\r\n    };\r\n    /* @ngInject */ RichTextFieldComponent.prototype.toggleSubmitButton = function (state) {\r\n        this.widget.editor.api.setInProgress(state);\r\n    };\r\n    __decorate([\r\n        ViewChild('textarea', { static: false }),\r\n        __metadata(\"design:type\", ElementRef)\r\n    ], /* @ngInject */ RichTextFieldComponent.prototype, \"textarea\", void 0);\r\n    /* @ngInject */ RichTextFieldComponent = __decorate([\r\n        SeDowngradeComponent(),\r\n        Component({\r\n            selector: 'se-rich-text-field',\r\n            template: \"<textarea #textarea class=\\\"fd-form__control\\\" [ngClass]=\\\"{'has-error': widget.field.hasErrors}\\\" name=\\\"{{widget.field.qualifier}}-{{widget.qualifier}}\\\" [disabled]=\\\"widget.isFieldDisabled()\\\" [(ngModel)]=\\\"widget.model[widget.qualifier]\\\" (change)=\\\"reassignUserCheck()\\\"></textarea><div *ngIf=\\\"requiresUserCheck()\\\"><div id=\\\"richTextWarningMessage\\\" [hidden]=\\\"widget.field.isUserChecked\\\"><span fd-status-label [status]=\\\"'warning'\\\" [icon]=\\\"'message-warning'\\\">{{'se.editor.richtext.message.warning' | translate}}</span></div><input id=\\\"richTextWarningCheckBox\\\" type=\\\"checkbox\\\" [(ngModel)]=\\\"widget.field.isUserChecked\\\" (click)=\\\"checkboxOnClick($event.target)\\\"/> <span [ngClass]=\\\"{'warning-check-msg': true, 'not-checked': widget.editor.hasFrontEndValidationErrors && !widget.field.isUserChecked}\\\">{{'se.editor.richtext.check' | translate}}</span></div>\"\r\n        }),\r\n        __param(0, Inject(GENERIC_EDITOR_WIDGET_DATA)),\r\n        __param(2, Inject(RICH_TEXT_CONFIGURATION)),\r\n        __metadata(\"design:paramtypes\", [Object, RichTextLoaderService, Object, GenericEditorSanitizationService,\r\n            RichTextFieldLocalizationService,\r\n            SettingsService])\r\n    ], /* @ngInject */ RichTextFieldComponent);\r\n    return /* @ngInject */ RichTextFieldComponent;\r\n}());\r\nexport { /* @ngInject */ RichTextFieldComponent };\r\n//# sourceMappingURL=RichTextFieldComponent.js.map","references":["/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular/core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/dist/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/di/index.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/services/index.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/components/genericEditor/types.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/components/genericEditor/components/tokens.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/components/genericEditor/widgets/RichTextField/services/GenericEditorSanitizationService.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/components/genericEditor/widgets/RichTextField/services/RichTextFieldLocalizationService.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/components/genericEditor/widgets/RichTextField/services/RichTextLoaderService.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/components/genericEditor/widgets/RichTextField/tokens.ts"],"map":"{\"version\":3,\"file\":\"RichTextFieldComponent.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../../src/components/genericEditor/widgets/RichTextField/RichTextFieldComponent.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/components/genericEditor/widgets/RichTextField/RichTextFieldComponent.d.ts","writeByteOrderMark":false,"text":"import { AfterViewInit, OnDestroy } from '@angular/core';\r\nimport { TypedMap } from '@smart/utils';\r\nimport { SettingsService } from 'smarteditcommons/services';\r\nimport { GenericEditorWidgetData } from '../../../genericEditor/types';\r\nimport { GenericEditorSanitizationService } from './services/GenericEditorSanitizationService';\r\nimport { RichTextFieldLocalizationService } from './services/RichTextFieldLocalizationService';\r\nimport { RichTextLoaderService } from './services/RichTextLoaderService';\r\nexport declare class RichTextFieldComponent implements AfterViewInit, OnDestroy {\r\n    widget: GenericEditorWidgetData<any>;\r\n    private seRichTextLoaderService;\r\n    private seRichTextConfiguration;\r\n    private genericEditorSanitizationService;\r\n    private seRichTextFieldLocalizationService;\r\n    private settingsService;\r\n    private textarea;\r\n    private editorInstance;\r\n    constructor(widget: GenericEditorWidgetData<any>, seRichTextLoaderService: RichTextLoaderService, seRichTextConfiguration: TypedMap<any>, genericEditorSanitizationService: GenericEditorSanitizationService, seRichTextFieldLocalizationService: RichTextFieldLocalizationService, settingsService: SettingsService);\r\n    ngAfterViewInit(): Promise<void>;\r\n    ngOnDestroy(): void;\r\n    onChange(): void;\r\n    onMode(): void;\r\n    onInstanceReady(ev: any): void;\r\n    requiresUserCheck(): boolean;\r\n    reassignUserCheck(): void;\r\n    checkboxOnClick(event: HTMLInputElement): void;\r\n    private toggleSubmitButton;\r\n}\r\n"}}
