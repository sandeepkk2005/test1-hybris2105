{"code":"import { __decorate, __metadata, __param } from \"tslib\";\r\n/*\r\n * Copyright (c) 2021 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { Inject } from '@angular/core';\r\nimport { IPositionRegistry, SeDowngradeService, YJQUERY_TOKEN } from 'smarteditcommons';\r\n/**\r\n * Service aimed at determining the list of registered DOM elements that have been repositioned, regardless of how, since it was last queried\r\n */\r\nvar /* @ngInject */ PositionRegistry = /** @class */ (function () {\r\n    function /* @ngInject */ PositionRegistry(yjQuery) {\r\n        this.yjQuery = yjQuery;\r\n        this.positionRegistry = [];\r\n    }\r\n    /**\r\n     * registers a given node in the repositioning registry\r\n     */\r\n    /* @ngInject */ PositionRegistry.prototype.register = function (element) {\r\n        this.unregister(element);\r\n        this.positionRegistry.push({\r\n            element: element,\r\n            position: this.calculatePositionHash(element)\r\n        });\r\n    };\r\n    /**\r\n     * unregisters a given node from the repositioning registry\r\n     */\r\n    /* @ngInject */ PositionRegistry.prototype.unregister = function (element) {\r\n        var entryToBeRemoved = this.positionRegistry.find(function (entry) { return entry.element === element; });\r\n        var index = this.positionRegistry.indexOf(entryToBeRemoved);\r\n        if (index > -1) {\r\n            this.positionRegistry.splice(index, 1);\r\n        }\r\n    };\r\n    /**\r\n     * Method returning the list of nodes having been repositioned since last query\r\n     */\r\n    /* @ngInject */ PositionRegistry.prototype.getRepositionedComponents = function () {\r\n        var _this = this;\r\n        return this.positionRegistry\r\n            .filter(function (entry) {\r\n            // to ignore elements that would keep showing here because of things like display table-inline\r\n            return _this.yjQuery(entry.element).height() !== 0;\r\n        })\r\n            .filter(function (entry) {\r\n            var element = entry.element;\r\n            var newPosition = _this.calculatePositionHash(element);\r\n            if (newPosition !== entry.position) {\r\n                entry.position = newPosition;\r\n                return true;\r\n            }\r\n            else {\r\n                return false;\r\n            }\r\n        })\r\n            .map(function (entry) { return entry.element; });\r\n    };\r\n    /**\r\n     * unregisters all nodes and cleans up\r\n     */\r\n    /* @ngInject */ PositionRegistry.prototype.dispose = function () {\r\n        this.positionRegistry = [];\r\n    };\r\n    /**\r\n     * for e2e test purposes\r\n     */\r\n    /* @ngInject */ PositionRegistry.prototype._listenerCount = function () {\r\n        return this.positionRegistry.length;\r\n    };\r\n    /* @ngInject */ PositionRegistry.prototype.floor = function (val) {\r\n        return Math.floor(val * 100) / 100;\r\n    };\r\n    /* @ngInject */ PositionRegistry.prototype.calculatePositionHash = function (element) {\r\n        var rootPosition = this.yjQuery('body')[0].getBoundingClientRect();\r\n        var position = element.getBoundingClientRect();\r\n        return (this.floor(position.top - rootPosition.top) +\r\n            '_' +\r\n            this.floor(position.left - rootPosition.left));\r\n    };\r\n    /* @ngInject */ PositionRegistry = __decorate([\r\n        SeDowngradeService(IPositionRegistry),\r\n        __param(0, Inject(YJQUERY_TOKEN)),\r\n        __metadata(\"design:paramtypes\", [Function])\r\n    ], /* @ngInject */ PositionRegistry);\r\n    return /* @ngInject */ PositionRegistry;\r\n}());\r\nexport { /* @ngInject */ PositionRegistry };\r\n//# sourceMappingURL=PositionRegistry.js.map","references":["/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular/core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts"],"map":"{\"version\":3,\"file\":\"PositionRegistry.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/services/PositionRegistry.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit/services/PositionRegistry.d.ts","writeByteOrderMark":false,"text":"import { IPositionRegistry, YJQuery } from 'smarteditcommons';\r\n/**\r\n * Service aimed at determining the list of registered DOM elements that have been repositioned, regardless of how, since it was last queried\r\n */\r\nexport declare class PositionRegistry implements IPositionRegistry {\r\n    private yjQuery;\r\n    private positionRegistry;\r\n    constructor(yjQuery: YJQuery);\r\n    /**\r\n     * registers a given node in the repositioning registry\r\n     */\r\n    register(element: HTMLElement): void;\r\n    /**\r\n     * unregisters a given node from the repositioning registry\r\n     */\r\n    unregister(element: HTMLElement): void;\r\n    /**\r\n     * Method returning the list of nodes having been repositioned since last query\r\n     */\r\n    getRepositionedComponents(): HTMLElement[];\r\n    /**\r\n     * unregisters all nodes and cleans up\r\n     */\r\n    dispose(): void;\r\n    /**\r\n     * for e2e test purposes\r\n     */\r\n    _listenerCount(): number;\r\n    private floor;\r\n    private calculatePositionHash;\r\n}\r\n"}}
