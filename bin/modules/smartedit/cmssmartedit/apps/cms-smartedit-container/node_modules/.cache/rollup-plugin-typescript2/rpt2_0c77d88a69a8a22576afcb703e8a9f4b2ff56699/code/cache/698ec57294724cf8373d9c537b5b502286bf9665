{"code":"import { __awaiter, __decorate, __generator, __metadata, __param } from \"tslib\";\r\nimport { ChangeDetectionStrategy, ChangeDetectorRef, Component, Inject } from '@angular/core';\r\nimport { isEmpty } from 'lodash';\r\nimport { take } from 'rxjs/operators';\r\nimport { L10nPipe, GENERIC_EDITOR_WIDGET_DATA } from 'smarteditcommons';\r\nimport { WorkflowService } from '../../workflow/services/WorkflowService';\r\nwindow.__smartedit__.addDecoratorPayload(\"Component\", \"WorkflowCreateVersionFieldComponent\", {\r\n    selector: 'se-workflow-create-version-field',\r\n    template: \"<div class=\\\"fd-form__set\\\"><div class=\\\"fd-form__item fd-form__item--check\\\"><label class=\\\"fd-form__label\\\"><input type=\\\"checkbox\\\" class=\\\"fd-form__control\\\" name=\\\"createVersion\\\" [(ngModel)]=\\\"model.createVersion\\\"/> {{ 'se.cms.workflow.editor.create.version' | translate }}</label></div><div class=\\\"fd-form__item\\\" *ngIf=\\\"model.createVersion\\\"><label class=\\\"fd-form__label version-label__title\\\" for=\\\"versionLabel\\\" translate=\\\"se.cms.workflow.editor.create.version.label\\\"></label> <input type=\\\"text\\\" name=\\\"versionLabel\\\" class=\\\"fd-form__control\\\" [class.has-error]=\\\"field.hasErrors\\\" [(ngModel)]=\\\"model.versionLabel\\\"/></div></div>\",\r\n    providers: [L10nPipe],\r\n    changeDetection: ChangeDetectionStrategy.OnPush\r\n});\r\nvar WorkflowCreateVersionFieldComponent = /** @class */ (function () {\r\n    function WorkflowCreateVersionFieldComponent(workflowService, data, cdr, l10nPipe) {\r\n        this.workflowService = workflowService;\r\n        this.data = data;\r\n        this.cdr = cdr;\r\n        this.l10nPipe = l10nPipe;\r\n        (this.field = data.field, this.model = data.model, this.editor = data.editor);\r\n    }\r\n    WorkflowCreateVersionFieldComponent.prototype.ngOnInit = function () {\r\n        var _this = this;\r\n        this.unregisterOnChangeEvent = this.editor.api.addContentChangeEvent(function () {\r\n            return _this.onCreateVersionChange();\r\n        });\r\n    };\r\n    WorkflowCreateVersionFieldComponent.prototype.ngOnDestroy = function () {\r\n        this.unregisterOnChangeEvent();\r\n    };\r\n    WorkflowCreateVersionFieldComponent.prototype.onCreateVersionChange = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var workflowActions, workflowAction, workflowDecision, _a, workflowDecisionName, workflowActionName, workflow, workflowName;\r\n            var _this = this;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        if (this.model.createVersion === false) {\r\n                            this.model.versionLabel = null;\r\n                            this.cdr.detectChanges();\r\n                            return [2 /*return*/];\r\n                        }\r\n                        if (!isEmpty(this.model.versionLabel)) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        if (!this.model.decisionCode) return [3 /*break*/, 3];\r\n                        return [4 /*yield*/, this.workflowService.getAllActionsForWorkflowCode(this.model.workflowCode)];\r\n                    case 1:\r\n                        workflowActions = _b.sent();\r\n                        workflowAction = workflowActions.find(function (action) { return action.code === _this.model.actionCode; });\r\n                        workflowDecision = workflowAction.decisions.find(function (decision) { return decision.code === _this.model.decisionCode; });\r\n                        return [4 /*yield*/, Promise.all([\r\n                                this.l10nPipe.transform(workflowDecision.name).pipe(take(1)).toPromise(),\r\n                                this.l10nPipe.transform(workflowAction.name).pipe(take(1)).toPromise()\r\n                            ])];\r\n                    case 2:\r\n                        _a = _b.sent(), workflowDecisionName = _a[0], workflowActionName = _a[1];\r\n                        this.model.versionLabel = workflowDecisionName + \" for \" + workflowActionName;\r\n                        this.cdr.detectChanges();\r\n                        return [2 /*return*/];\r\n                    case 3: return [4 /*yield*/, this.workflowService.getWorkflowTemplateByCode(this.model.templateCode)];\r\n                    case 4:\r\n                        workflow = _b.sent();\r\n                        if (!workflow) return [3 /*break*/, 6];\r\n                        return [4 /*yield*/, this.l10nPipe\r\n                                .transform(workflow.name)\r\n                                .pipe(take(1))\r\n                                .toPromise()];\r\n                    case 5:\r\n                        workflowName = _b.sent();\r\n                        this.model.versionLabel = workflowName + \" workflow started\";\r\n                        this.cdr.detectChanges();\r\n                        _b.label = 6;\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WorkflowCreateVersionFieldComponent = __decorate([\r\n        Component({\r\n            selector: 'se-workflow-create-version-field',\r\n            template: \"<div class=\\\"fd-form__set\\\"><div class=\\\"fd-form__item fd-form__item--check\\\"><label class=\\\"fd-form__label\\\"><input type=\\\"checkbox\\\" class=\\\"fd-form__control\\\" name=\\\"createVersion\\\" [(ngModel)]=\\\"model.createVersion\\\"/> {{ 'se.cms.workflow.editor.create.version' | translate }}</label></div><div class=\\\"fd-form__item\\\" *ngIf=\\\"model.createVersion\\\"><label class=\\\"fd-form__label version-label__title\\\" for=\\\"versionLabel\\\" translate=\\\"se.cms.workflow.editor.create.version.label\\\"></label> <input type=\\\"text\\\" name=\\\"versionLabel\\\" class=\\\"fd-form__control\\\" [class.has-error]=\\\"field.hasErrors\\\" [(ngModel)]=\\\"model.versionLabel\\\"/></div></div>\",\r\n            providers: [L10nPipe],\r\n            changeDetection: ChangeDetectionStrategy.OnPush\r\n        }),\r\n        __param(1, Inject(GENERIC_EDITOR_WIDGET_DATA)),\r\n        __metadata(\"design:paramtypes\", [WorkflowService, Object, ChangeDetectorRef,\r\n            L10nPipe])\r\n    ], WorkflowCreateVersionFieldComponent);\r\n    return WorkflowCreateVersionFieldComponent;\r\n}());\r\nexport { WorkflowCreateVersionFieldComponent };\r\n//# sourceMappingURL=WorkflowCreateVersionFieldComponent.js.map","references":["/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular/core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@types/lodash@4.14.159/node_modules/@types/lodash/ts3.1/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/rxjs@6.5.4/node_modules/rxjs/operators/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/components/workflow/dtos/index.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/components/workflow/services/WorkflowService.ts"],"map":"{\"version\":3,\"file\":\"WorkflowCreateVersionFieldComponent.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/components/genericEditor/workflowCreateVersionField/WorkflowCreateVersionFieldComponent.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/components/genericEditor/workflowCreateVersionField/WorkflowCreateVersionFieldComponent.d.ts","writeByteOrderMark":false,"text":"import { ChangeDetectorRef, OnDestroy, OnInit } from '@angular/core';\r\nimport { L10nPipe, GenericEditorField, GenericEditorWidgetData, Nullable } from 'smarteditcommons';\r\nimport { WorkflowService } from '../../workflow/services/WorkflowService';\r\ninterface WorkflowCreateVersionFieldData {\r\n    workflowCode: string;\r\n    actionCode: string;\r\n    decisionCode: string;\r\n    templateCode: string;\r\n    createVersion: boolean;\r\n    versionLabel: Nullable<string>;\r\n}\r\nexport declare class WorkflowCreateVersionFieldComponent implements OnInit, OnDestroy {\r\n    private workflowService;\r\n    data: GenericEditorWidgetData<WorkflowCreateVersionFieldData>;\r\n    private cdr;\r\n    private l10nPipe;\r\n    field: GenericEditorField;\r\n    model: WorkflowCreateVersionFieldData;\r\n    private editor;\r\n    private unregisterOnChangeEvent;\r\n    constructor(workflowService: WorkflowService, data: GenericEditorWidgetData<WorkflowCreateVersionFieldData>, cdr: ChangeDetectorRef, l10nPipe: L10nPipe);\r\n    ngOnInit(): void;\r\n    ngOnDestroy(): void;\r\n    onCreateVersionChange(): Promise<void>;\r\n}\r\nexport {};\r\n"}}
