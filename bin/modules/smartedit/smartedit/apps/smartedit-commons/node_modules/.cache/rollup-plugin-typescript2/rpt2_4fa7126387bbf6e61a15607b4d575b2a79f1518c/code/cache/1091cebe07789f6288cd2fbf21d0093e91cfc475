{"code":"import { __decorate, __metadata, __param } from \"tslib\";\r\n/*\r\n * Copyright (c) 2021 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { DOCUMENT } from '@angular/common';\r\nimport { Inject } from '@angular/core';\r\nimport { LogService } from '@smart/utils';\r\nimport * as lodash from 'lodash';\r\nimport { SeDowngradeService } from 'smarteditcommons/di';\r\nimport { nodeUtils, stringUtils, MUTATION_TYPES } from 'smarteditcommons/utils';\r\nimport { YJQUERY_TOKEN } from '../vendors/YjqueryModule';\r\nvar IN_VIEW_ELEMENTS_INTERSECTION_OBSERVER_OPTIONS = {\r\n    // The root to use for intersection.\r\n    // If not provided, use the top-level documentâ€™s viewport.\r\n    root: null,\r\n    // Threshold(s) at which to trigger callback, specified as a ratio, or list of\r\n    // ratios, of (visible area / total area) of the observed element (hence all\r\n    // entries must be in the range [0, 1]). Callback will be invoked when the visible\r\n    // ratio of the observed element crosses a threshold in the list.\r\n    threshold: 0\r\n};\r\n/*\r\n * This is the configuration passed to the MutationObserver instance\r\n */\r\nvar IN_VIEW_ELEMENTS_MUTATION_OBSERVER_OPTIONS = {\r\n    /*\r\n     * enables observation of attribute mutations precisely for class=\"smartEditComponent\" that may be added dynamically\r\n     * turned to true dynamically if at least of the selectors is class sensitive\r\n     */\r\n    attributes: true,\r\n    /*\r\n     * instruct the observer not to keep in store the former values of the mutated attributes\r\n     */\r\n    attributeOldValue: false,\r\n    /*\r\n     * enables observation of addition and removal of nodes\r\n     */\r\n    childList: true,\r\n    characterData: false,\r\n    /*\r\n     * enables recursive lookup without which only addition and removal of DIRECT children of the observed DOM root would be collected\r\n     */\r\n    subtree: true\r\n};\r\n/**\r\n * InViewElementObserver maintains a collection of eligible DOM elements considered \"in view\".\r\n * An element is considered eligible if matches at least one of the selectors passed to the service.\r\n * An eligible element is in view when and only when it intersects with the view port of the window frame.\r\n * This services provides as well convenience methods around \"in view\" components:\r\n */\r\nvar /* @ngInject */ InViewElementObserver = /** @class */ (function () {\r\n    function /* @ngInject */ InViewElementObserver(logService, document, yjQuery) {\r\n        this.logService = logService;\r\n        this.document = document;\r\n        this.yjQuery = yjQuery;\r\n        /*\r\n         * Queue used to process components when intersecting the viewport\r\n         * {Array.<{isIntersecting: Boolean, parent: DOMElement, processed: COMPONENT_STATE}>}\r\n         */\r\n        this.componentsQueue = [];\r\n        this.selectors = [];\r\n        this.hasClassBasedSelectors = false;\r\n    }\r\n    /**\r\n     * Retrieves the element targeted by the given mousePosition.\r\n     * On some browsers, the native Javascript API will not work when targeting\r\n     * an element inside an iframe from the container if a container overlay blocks it.\r\n     * In such case we resort to returning the targeted element amongst the list of \"in view\" elements\r\n     */\r\n    /* @ngInject */ InViewElementObserver.prototype.elementFromPoint = function (mousePosition) {\r\n        var elementFromPointThroughNativeAPI = this.document.elementFromPoint(mousePosition.x, mousePosition.y);\r\n        // we might potentially have an issue here if a browser has an intersection observer and document.elementFromPoint returns null.\r\n        // Chrome version 66 when running in isE2EMode has the issue. But this is not likely to happen in reality because Chrome has an intersectionObserver\r\n        // and hence it should just use the result from document.elementFromPoint.\r\n        return (elementFromPointThroughNativeAPI ||\r\n            this.getInViewElements().find(function (component) {\r\n                return nodeUtils.isPointOverElement(mousePosition, component);\r\n            }));\r\n    };\r\n    /**\r\n     * Declares a new yjQuery selector in order to observe more elements.\r\n     */\r\n    /* @ngInject */ InViewElementObserver.prototype.addSelector = function (selector, callback) {\r\n        var _this = this;\r\n        if (!stringUtils.isBlank(selector) &&\r\n            this.selectors.map(function (el) { return el.selector; }).indexOf(selector) === -1) {\r\n            if (/\\.[\\w]+/.test(selector)) {\r\n                this.hasClassBasedSelectors = true;\r\n            }\r\n            this.selectors.push({ selector: selector, callback: callback });\r\n            this.restart();\r\n        }\r\n        return function () {\r\n            var index = _this.selectors.map(function (el) { return el.selector; }).indexOf(selector);\r\n            _this.selectors.splice(index, 1);\r\n            _this.restart();\r\n        };\r\n    };\r\n    /**\r\n     * Retrieves the full list of eligible DOM elements even if they are not \"in view\".\r\n     */\r\n    /* @ngInject */ InViewElementObserver.prototype.getAllElements = function () {\r\n        return this.componentsQueue.map(function (element) { return element.component; });\r\n    };\r\n    /**\r\n     * Retrieves the list of currently \"in view\" DOM elements.\r\n     */\r\n    /* @ngInject */ InViewElementObserver.prototype.getInViewElements = function () {\r\n        return this.componentsQueue\r\n            .filter(function (element) { return element.isIntersecting; })\r\n            .map(function (element) { return element.component; });\r\n    };\r\n    /* @ngInject */ InViewElementObserver.prototype.restart = function () {\r\n        this.stopListener();\r\n        this.initListener();\r\n    };\r\n    /*\r\n     * stops and clean up all listeners\r\n     */\r\n    /* @ngInject */ InViewElementObserver.prototype.stopListener = function () {\r\n        // Stop listening for DOM mutations\r\n        if (this.mutationObserver) {\r\n            this.mutationObserver.disconnect();\r\n            delete this.mutationObserver;\r\n        }\r\n        if (this.intersectionObserver) {\r\n            this.intersectionObserver.disconnect();\r\n            delete this.intersectionObserver;\r\n        }\r\n        this.componentsQueue = [];\r\n    };\r\n    /*\r\n     * initializes and starts all Intersection/DOM listeners:\r\n     * - Intersection of eligible components with the viewport\r\n     * - DOM mutations on eligible components (by Means of native MutationObserver)\r\n     */\r\n    /* @ngInject */ InViewElementObserver.prototype.initListener = function () {\r\n        var _this = this;\r\n        if (!this.mutationObserver) {\r\n            this.mutationObserver = this._newMutationObserver(this._mutationObserverCallback.bind(this));\r\n            if (!this.intersectionObserver) {\r\n                // Intersection Observer is used to observe intersection of components with the viewport.\r\n                // each time the 'isIntersecting' property of an entry changes, the Intersection Callback is called.\r\n                // we are using the componentsQueue to hold the components references and their isIntersecting value.\r\n                this.intersectionObserver = this._newIntersectionObserver(function (entries) {\r\n                    var eligibleEntries = entries.filter(function (entry) {\r\n                        return _this._isEligibleComponent(entry.target);\r\n                    });\r\n                    eligibleEntries.forEach(function (entry) {\r\n                        _this._updateQueue(entry);\r\n                    });\r\n                    /*\r\n                     * for each added selector, if at least one of the entries is a match, we call the assocated callback\r\n                     *\r\n                     */\r\n                    _this.selectors\r\n                        .filter(function (element) { return !!element.callback; })\r\n                        .forEach(function (element) {\r\n                        if (eligibleEntries.find(function (entry) {\r\n                            return _this.yjQuery(entry.target).is(element.selector);\r\n                        })) {\r\n                            element.callback();\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n            // Observing all eligible components that are already in the page.\r\n            // Note that when an element visible in the viewport is removed, the Intersection Callback is called so we don't need to use the Mutation Observe to oberser removal of Nodes.\r\n            this._getEligibleElements().forEach(function (component) {\r\n                _this.intersectionObserver.observe(component);\r\n            });\r\n        }\r\n    };\r\n    /*\r\n     * Method used in mutationObserverCallback that extracts from mutations the list of added and removed nodes\r\n     */\r\n    /* @ngInject */ InViewElementObserver.prototype._aggregateAddedOrRemovedNodes = function (mutations, addedOnes) {\r\n        var _this = this;\r\n        var entries = lodash.flatten(mutations\r\n            .filter(function (mutation) {\r\n            // only keep mutations of type childList and addedNodes\r\n            return mutation.type === MUTATION_TYPES.CHILD_LIST.NAME &&\r\n                ((!!addedOnes && mutation.addedNodes && mutation.addedNodes.length) ||\r\n                    (!addedOnes && mutation.removedNodes && mutation.removedNodes.length));\r\n        })\r\n            .map(function (mutation) {\r\n            var children = lodash\r\n                .flatten(Array.prototype.slice\r\n                .call(addedOnes ? mutation.addedNodes : mutation.removedNodes)\r\n                .filter(function (node) { return node.nodeType === Node.ELEMENT_NODE; })\r\n                .map(function (child) {\r\n                var eligibleChildren = _this._getAllEligibleChildren(child);\r\n                return _this._isEligibleComponent(child)\r\n                    ? [child].concat(eligibleChildren)\r\n                    : eligibleChildren;\r\n            }))\r\n                .sort(nodeUtils.compareHTMLElementsPosition())\r\n                // so that in case of nested eligible components the deeper element is picked\r\n                .reverse();\r\n            return children;\r\n        }));\r\n        /*\r\n         * Despite MutationObserver specifications it so happens that sometimes,\r\n         * depending on the very way a parent node is added with its children,\r\n         * parent AND children will appear in a same mutation. We then must only keep the parent\r\n         * Since the parent will appear first, the filtering lodash.uniqWith will always return the parent as opposed to the child which is what we need\r\n         */\r\n        return lodash.uniqWith(entries, function (entry1, entry2) {\r\n            return entry1.contains(entry2) || entry2.contains(entry1);\r\n        });\r\n    };\r\n    /*\r\n     * Method used in mutationObserverCallback that extracts from mutations the list of nodes that have a mutation in the class attribute value\r\n     */\r\n    /* @ngInject */ InViewElementObserver.prototype._aggregateMutationsOnClass = function (mutations, addedOnes) {\r\n        var _this = this;\r\n        return lodash.compact(mutations\r\n            .filter(function (mutation) {\r\n            return mutation.target &&\r\n                mutation.target.nodeType === Node.ELEMENT_NODE &&\r\n                mutation.type === MUTATION_TYPES.ATTRIBUTES.NAME &&\r\n                mutation.attributeName === 'class';\r\n        })\r\n            .map(function (mutation) {\r\n            if (addedOnes && _this._isEligibleComponent(mutation.target)) {\r\n                return mutation.target;\r\n            }\r\n            else if (!addedOnes &&\r\n                _this._isEligibleComponent(mutation.target)) {\r\n                return mutation.target;\r\n            }\r\n            return null;\r\n        }));\r\n    };\r\n    /*\r\n     * callback executed by the mutation observer every time mutations occur.\r\n     * repositioning and resizing are not part of this except that every time a eligible component is added,\r\n     * it is registered within the positionRegistry and the resizeListener\r\n     */\r\n    /* @ngInject */ InViewElementObserver.prototype._mutationObserverCallback = function (mutations) {\r\n        var _this = this;\r\n        this.logService.debug(mutations);\r\n        this._aggregateAddedOrRemovedNodes(mutations, true).forEach(function (node) {\r\n            _this.intersectionObserver.observe(node);\r\n        });\r\n        if (this.hasClassBasedSelectors) {\r\n            this._aggregateMutationsOnClass(mutations, true).forEach(function (node) {\r\n                _this.intersectionObserver.observe(node);\r\n            });\r\n        }\r\n        this._aggregateAddedOrRemovedNodes(mutations, false).forEach(function (node) {\r\n            var componentIndex = _this._getComponentIndexInQueue(node);\r\n            if (componentIndex !== -1) {\r\n                _this.componentsQueue.splice(componentIndex, 1);\r\n            }\r\n        });\r\n        if (this.hasClassBasedSelectors) {\r\n            this._aggregateMutationsOnClass(mutations, false).forEach(function (node) {\r\n                var componentIndex = _this._getComponentIndexInQueue(node);\r\n                if (componentIndex !== -1) {\r\n                    _this.componentsQueue.splice(componentIndex, 1);\r\n                }\r\n            });\r\n        }\r\n    };\r\n    /*\r\n     * Add the given entry to the componentsQueue\r\n     * The components in the queue are sorted according to their position in the DOM\r\n     * so that the adding of components is done to have parents before children\r\n     */\r\n    /* @ngInject */ InViewElementObserver.prototype._updateQueue = function (entry) {\r\n        var componentIndex = this._getComponentIndexInQueue(entry.target);\r\n        if (componentIndex !== -1) {\r\n            if (!entry.intersectionRatio && !this._isInDOM(entry.target)) {\r\n                this.componentsQueue.splice(componentIndex, 1);\r\n            }\r\n            else {\r\n                this.componentsQueue[componentIndex].isIntersecting = !!entry.intersectionRatio;\r\n            }\r\n        }\r\n        else if (this._isInDOM(entry.target)) {\r\n            // may have been removed by competing MutationObserver hence showign here but not intersecting\r\n            this.componentsQueue.push({\r\n                component: entry.target,\r\n                isIntersecting: !!entry.intersectionRatio\r\n            });\r\n        }\r\n    };\r\n    /// ///////////////////////////////////////////////////////////////////////////////////\r\n    /// ///////////////////////////// HELPER METHODS //////////////////////////////////////\r\n    /// ///////////////////////////////////////////////////////////////////////////////////\r\n    /*\r\n     * wrapping for test purposes\r\n     */\r\n    /* @ngInject */ InViewElementObserver.prototype._newMutationObserver = function (callback) {\r\n        var mutationObserver = new MutationObserver(callback);\r\n        mutationObserver.observe(this.document.body, lodash.merge(lodash.cloneDeep(IN_VIEW_ELEMENTS_MUTATION_OBSERVER_OPTIONS), {\r\n            attributes: this.hasClassBasedSelectors\r\n        }));\r\n        return mutationObserver;\r\n    };\r\n    /*\r\n     * wrapping for test purposes\r\n     */\r\n    /* @ngInject */ InViewElementObserver.prototype._newIntersectionObserver = function (callback) {\r\n        return new IntersectionObserver(callback, IN_VIEW_ELEMENTS_INTERSECTION_OBSERVER_OPTIONS);\r\n    };\r\n    /* @ngInject */ InViewElementObserver.prototype._getJQuerySelector = function () {\r\n        return this.selectors.map(function (el) { return el.selector; }).join(',');\r\n    };\r\n    /* @ngInject */ InViewElementObserver.prototype._isEligibleComponent = function (component) {\r\n        return this.yjQuery(component).is(this._getJQuerySelector());\r\n    };\r\n    /* @ngInject */ InViewElementObserver.prototype._getEligibleElements = function () {\r\n        return Array.prototype.slice.call(this.yjQuery(this._getJQuerySelector()));\r\n    };\r\n    /* @ngInject */ InViewElementObserver.prototype._getAllEligibleChildren = function (component) {\r\n        return Array.prototype.slice.call(component.querySelectorAll(this._getJQuerySelector()));\r\n    };\r\n    /* @ngInject */ InViewElementObserver.prototype._getComponentIndexInQueue = function (component) {\r\n        return this.componentsQueue.findIndex(function (obj) {\r\n            return component === obj.component;\r\n        });\r\n    };\r\n    /* @ngInject */ InViewElementObserver.prototype._isInDOM = function (component) {\r\n        return this.yjQuery.contains(this.document.body, component);\r\n    };\r\n    /* @ngInject */ InViewElementObserver = __decorate([\r\n        SeDowngradeService(),\r\n        __param(1, Inject(DOCUMENT)),\r\n        __param(2, Inject(YJQUERY_TOKEN)),\r\n        __metadata(\"design:paramtypes\", [LogService,\r\n            Document, Function])\r\n    ], /* @ngInject */ InViewElementObserver);\r\n    return /* @ngInject */ InViewElementObserver;\r\n}());\r\nexport { /* @ngInject */ InViewElementObserver };\r\n//# sourceMappingURL=InViewElementObserver.js.map","references":["/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular/common@8.2.14_@angular+core@8.2.14+rxjs@6.5.4/node_modules/@angular/common/common.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular/core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/dist/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@types/lodash@4.14.159/node_modules/@types/lodash/ts3.1/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/di/index.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/utils/index.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/services/vendors/YjqueryModule.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/services/dragAndDrop/index.ts"],"map":"{\"version\":3,\"file\":\"InViewElementObserver.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/services/dragAndDrop/InViewElementObserver.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/services/dragAndDrop/InViewElementObserver.d.ts","writeByteOrderMark":false,"text":"/// <reference types=\"angular\" />\r\n/// <reference types=\"jquery\" />\r\nimport { LogService } from '@smart/utils';\r\nimport { IMousePosition } from './index';\r\nexport interface QueueElement {\r\n    component: HTMLElement;\r\n    isIntersecting: boolean;\r\n}\r\n/**\r\n * InViewElementObserver maintains a collection of eligible DOM elements considered \"in view\".\r\n * An element is considered eligible if matches at least one of the selectors passed to the service.\r\n * An eligible element is in view when and only when it intersects with the view port of the window frame.\r\n * This services provides as well convenience methods around \"in view\" components:\r\n */\r\nexport declare class InViewElementObserver {\r\n    private logService;\r\n    private document;\r\n    private yjQuery;\r\n    private mutationObserver;\r\n    private intersectionObserver;\r\n    private componentsQueue;\r\n    private selectors;\r\n    private hasClassBasedSelectors;\r\n    constructor(logService: LogService, document: Document, yjQuery: JQueryStatic);\r\n    /**\r\n     * Retrieves the element targeted by the given mousePosition.\r\n     * On some browsers, the native Javascript API will not work when targeting\r\n     * an element inside an iframe from the container if a container overlay blocks it.\r\n     * In such case we resort to returning the targeted element amongst the list of \"in view\" elements\r\n     */\r\n    elementFromPoint(mousePosition: IMousePosition): Element;\r\n    /**\r\n     * Declares a new yjQuery selector in order to observe more elements.\r\n     */\r\n    addSelector(selector: string, callback?: () => void): () => void;\r\n    /**\r\n     * Retrieves the full list of eligible DOM elements even if they are not \"in view\".\r\n     */\r\n    getAllElements(): Element[];\r\n    /**\r\n     * Retrieves the list of currently \"in view\" DOM elements.\r\n     */\r\n    getInViewElements(): Element[];\r\n    private restart;\r\n    private stopListener;\r\n    private initListener;\r\n    private _aggregateAddedOrRemovedNodes;\r\n    private _aggregateMutationsOnClass;\r\n    private _mutationObserverCallback;\r\n    private _updateQueue;\r\n    private _newMutationObserver;\r\n    private _newIntersectionObserver;\r\n    private _getJQuerySelector;\r\n    private _isEligibleComponent;\r\n    private _getEligibleElements;\r\n    private _getAllEligibleChildren;\r\n    private _getComponentIndexInQueue;\r\n    private _isInDOM;\r\n}\r\n"}}
