{"code":"import { __decorate, __extends, __metadata, __param } from \"tslib\";\r\n/*\r\n * Copyright (c) 2021 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { DOCUMENT } from '@angular/common';\r\nimport { Inject } from '@angular/core';\r\nimport { CrossFrameEventService, DragAndDropScrollingService, InViewElementObserver, IDragAndDropCrossOrigin, IDragEventType, PolyfillService, SeDowngradeService, SMARTEDIT_DRAG_AND_DROP_EVENTS, SMARTEDIT_ELEMENT_HOVERED, YJQUERY_TOKEN } from 'smarteditcommons';\r\n/** @internal */\r\nvar /* @ngInject */ DragAndDropCrossOrigin = /** @class */ (function (_super) {\r\n    __extends(/* @ngInject */ DragAndDropCrossOrigin, _super);\r\n    function /* @ngInject */ DragAndDropCrossOrigin(document, yjQuery, crossFrameEventService, inViewElementObserver, dragAndDropScrollingService, polyfillService) {\r\n        var _this = _super.call(this) || this;\r\n        _this.document = document;\r\n        _this.yjQuery = yjQuery;\r\n        _this.crossFrameEventService = crossFrameEventService;\r\n        _this.inViewElementObserver = inViewElementObserver;\r\n        _this.dragAndDropScrollingService = dragAndDropScrollingService;\r\n        _this.polyfillService = polyfillService;\r\n        _this.onDnDCrossOriginStart = function (eventId) {\r\n            _this.dragAndDropScrollingService.toggleThrottling(_this.polyfillService.isEligibleForThrottledScrolling());\r\n        };\r\n        _this.onTrackMouseInner = function (eventId, eventData) {\r\n            if (_this.isSearchingElement) {\r\n                return;\r\n            }\r\n            _this.isSearchingElement = true;\r\n            /**\r\n             * Get the element from mouse position.\r\n             * In IE11, document.elementFromPoint returns null because of the #ySmartEditFrameDragArea positioned over the iframe and has pointer-events (necessary to listen on 'dragover' to track the mouse position).\r\n             * To polyfill document.elementFromPoint in IE11 in this scenario, we call isPointOverElement() on each elligible droppable element.\r\n             *\r\n             * Note: in IE11, a switch of pointer-events value to none for the #ySmartEditFrameDragArea will return a value when calling $document.elementFromPoint, BUT it is causing cursor flickering and too much latency. The 'isPointOverElement' approach give better results.\r\n             */\r\n            _this.currentElementHovered = _this.yjQuery(_this.inViewElementObserver.elementFromPoint(eventData));\r\n            var mousePositionInPage = _this.getMousePositionInPage(eventData);\r\n            if (_this.lastElementHovered && _this.lastElementHovered.length) {\r\n                if ((_this.currentElementHovered.length &&\r\n                    _this.lastElementHovered[0] !== _this.currentElementHovered[0]) ||\r\n                    !_this.currentElementHovered.length) {\r\n                    _this.dispatchDragEvent(_this.lastElementHovered[0], IDragEventType.DRAG_LEAVE, mousePositionInPage);\r\n                    _this.lastElementHovered.data(SMARTEDIT_ELEMENT_HOVERED, false);\r\n                }\r\n            }\r\n            if (_this.currentElementHovered.length) {\r\n                if (!_this.currentElementHovered.data(SMARTEDIT_ELEMENT_HOVERED)) {\r\n                    _this.dispatchDragEvent(_this.currentElementHovered[0], IDragEventType.DRAG_ENTER, mousePositionInPage);\r\n                    _this.currentElementHovered.data(SMARTEDIT_ELEMENT_HOVERED, true);\r\n                }\r\n                _this.dispatchDragEvent(_this.currentElementHovered[0], IDragEventType.DRAG_OVER, mousePositionInPage);\r\n            }\r\n            _this.lastElementHovered = _this.currentElementHovered;\r\n            _this.isSearchingElement = false;\r\n        };\r\n        _this.onDropElementInner = function (eventId, mousePosition) {\r\n            if (_this.currentElementHovered.length) {\r\n                _this.currentElementHovered.data(SMARTEDIT_ELEMENT_HOVERED, false);\r\n                _this.dispatchDragEvent(_this.currentElementHovered[0], IDragEventType.DROP, mousePosition);\r\n                _this.dispatchDragEvent(_this.currentElementHovered[0], IDragEventType.DRAG_LEAVE, mousePosition);\r\n            }\r\n        };\r\n        return _this;\r\n    }\r\n    /* @ngInject */ DragAndDropCrossOrigin.prototype.initialize = function () {\r\n        this.crossFrameEventService.subscribe(SMARTEDIT_DRAG_AND_DROP_EVENTS.TRACK_MOUSE_POSITION, this.onTrackMouseInner.bind(this));\r\n        this.crossFrameEventService.subscribe(SMARTEDIT_DRAG_AND_DROP_EVENTS.DROP_ELEMENT, this.onDropElementInner.bind(this));\r\n        this.crossFrameEventService.subscribe(SMARTEDIT_DRAG_AND_DROP_EVENTS.DRAG_DROP_CROSS_ORIGIN_START, this.onDnDCrossOriginStart.bind(this));\r\n    };\r\n    /* @ngInject */ DragAndDropCrossOrigin.prototype.dispatchDragEvent = function (element, type, mousePosition) {\r\n        var evt = this.document.createEvent('CustomEvent');\r\n        evt.initCustomEvent(type, true, true, null);\r\n        evt.dataTransfer = {\r\n            data: {},\r\n            // eslint-disable-next-line @typescript-eslint/ban-types\r\n            setData: function (_type, val) {\r\n                this.data[_type] = val;\r\n            },\r\n            getData: function (_type) {\r\n                return this.data[_type];\r\n            }\r\n        };\r\n        evt.pageX = mousePosition.x;\r\n        evt.pageY = mousePosition.y;\r\n        element.dispatchEvent(evt);\r\n    };\r\n    /* @ngInject */ DragAndDropCrossOrigin.prototype.getMousePositionInPage = function (mousePosition) {\r\n        var scrollingElement = this.yjQuery(this.document.scrollingElement || this.document.documentElement);\r\n        return {\r\n            x: mousePosition.x + scrollingElement.scrollLeft(),\r\n            y: mousePosition.y + scrollingElement.scrollTop()\r\n        };\r\n    };\r\n    /* @ngInject */ DragAndDropCrossOrigin = __decorate([\r\n        SeDowngradeService(IDragAndDropCrossOrigin),\r\n        __param(0, Inject(DOCUMENT)),\r\n        __param(1, Inject(YJQUERY_TOKEN)),\r\n        __metadata(\"design:paramtypes\", [Document, Function, CrossFrameEventService,\r\n            InViewElementObserver,\r\n            DragAndDropScrollingService,\r\n            PolyfillService])\r\n    ], /* @ngInject */ DragAndDropCrossOrigin);\r\n    return /* @ngInject */ DragAndDropCrossOrigin;\r\n}(IDragAndDropCrossOrigin));\r\nexport { /* @ngInject */ DragAndDropCrossOrigin };\r\n//# sourceMappingURL=DragAndDropCrossOriginInner.js.map","references":["/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular/common@8.2.14_@angular+core@8.2.14+rxjs@6.5.4/node_modules/@angular/common/common.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular/core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts"],"map":"{\"version\":3,\"file\":\"DragAndDropCrossOriginInner.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/services/DragAndDropCrossOriginInner.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit/services/DragAndDropCrossOriginInner.d.ts","writeByteOrderMark":false,"text":"/// <reference types=\"angular\" />\r\n/// <reference types=\"jquery\" />\r\nimport { CrossFrameEventService, DragAndDropScrollingService, InViewElementObserver, IDragAndDropCrossOrigin, PolyfillService } from 'smarteditcommons';\r\n/** @internal */\r\nexport declare class DragAndDropCrossOrigin extends IDragAndDropCrossOrigin {\r\n    private document;\r\n    private yjQuery;\r\n    private crossFrameEventService;\r\n    private inViewElementObserver;\r\n    private dragAndDropScrollingService;\r\n    private polyfillService;\r\n    private currentElementHovered;\r\n    private lastElementHovered;\r\n    private isSearchingElement;\r\n    constructor(document: Document, yjQuery: JQueryStatic, crossFrameEventService: CrossFrameEventService, inViewElementObserver: InViewElementObserver, dragAndDropScrollingService: DragAndDropScrollingService, polyfillService: PolyfillService);\r\n    initialize(): void;\r\n    private onDnDCrossOriginStart;\r\n    private onTrackMouseInner;\r\n    private onDropElementInner;\r\n    private dispatchDragEvent;\r\n    private getMousePositionInPage;\r\n}\r\n"}}
