{"code":"import { __awaiter, __decorate, __generator, __metadata } from \"tslib\";\r\n/*\r\n * Copyright (c) 2021 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { IPageService } from 'cmscommons';\r\nimport { SeDowngradeService, LogService } from 'smarteditcommons';\r\nimport { PageRestrictionsService } from '../services/pageRestrictions/PageRestrictionsService';\r\nvar /* @ngInject */ DisplayConditionsFacade = /** @class */ (function () {\r\n    function /* @ngInject */ DisplayConditionsFacade(pageService, pageRestrictionsService, logService) {\r\n        this.pageService = pageService;\r\n        this.pageRestrictionsService = pageRestrictionsService;\r\n        this.logService = logService;\r\n    }\r\n    /* @ngInject */ DisplayConditionsFacade.prototype.getPageInfoForPageUid = function (pageId) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var pagePromise, displayConditionsPromise, _a, page, isPrimary;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        pagePromise = this.pageService.getPageById(pageId);\r\n                        displayConditionsPromise = this.pageService.isPagePrimary(pageId);\r\n                        return [4 /*yield*/, Promise.all([pagePromise, displayConditionsPromise])];\r\n                    case 1:\r\n                        _a = _b.sent(), page = _a[0], isPrimary = _a[1];\r\n                        return [2 /*return*/, {\r\n                                pageName: page.name,\r\n                                pageType: page.typeCode,\r\n                                isPrimary: isPrimary\r\n                            }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /* @ngInject */ DisplayConditionsFacade.prototype.getVariationsForPageUid = function (primaryPageId) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var variationPages, restrictionCounts;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.pageService.getVariationPages(primaryPageId)];\r\n                    case 1:\r\n                        variationPages = _a.sent();\r\n                        if (variationPages.length === 0) {\r\n                            return [2 /*return*/, []];\r\n                        }\r\n                        return [4 /*yield*/, Promise.all(variationPages.map(function (variationPage) {\r\n                                return _this.pageRestrictionsService.getPageRestrictionsCountForPageUID(variationPage.uid);\r\n                            }))];\r\n                    case 2:\r\n                        restrictionCounts = _a.sent();\r\n                        return [2 /*return*/, variationPages.map(function (variationPage, index) { return ({\r\n                                pageName: variationPage.name,\r\n                                creationDate: variationPage.creationtime,\r\n                                restrictions: restrictionCounts[index]\r\n                            }); })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /* @ngInject */ DisplayConditionsFacade.prototype.updatePage = function (pageId, pageData) {\r\n        return this.pageService.updatePageById(pageId, pageData);\r\n    };\r\n    /* @ngInject */ DisplayConditionsFacade.prototype.isPagePrimary = function (pageId) {\r\n        return this.pageService.isPagePrimary(pageId);\r\n    };\r\n    /* @ngInject */ DisplayConditionsFacade.prototype.getPrimaryPageForVariationPage = function (variationPageId) {\r\n        return this.pageService.getPrimaryPage(variationPageId).then(function (primaryPage) { return ({\r\n            uid: primaryPage.uid,\r\n            name: primaryPage.name,\r\n            label: primaryPage.label\r\n        }); });\r\n    };\r\n    /* @ngInject */ DisplayConditionsFacade.prototype.getPrimaryPagesForPageType = function (pageTypeCode, uriParams, fetchPageParams) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var page, error_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 2, , 3]);\r\n                        return [4 /*yield*/, this.pageService.getPaginatedPrimaryPagesForPageType(pageTypeCode, uriParams, fetchPageParams)];\r\n                    case 1:\r\n                        page = _a.sent();\r\n                        return [2 /*return*/, {\r\n                                pagination: page.pagination,\r\n                                results: page.response.map(function (rawPage) { return ({\r\n                                    id: rawPage.uid,\r\n                                    label: rawPage.name || rawPage.label\r\n                                }); })\r\n                            }];\r\n                    case 2:\r\n                        error_1 = _a.sent();\r\n                        this.logService.warn(\"[getPrimaryPagesForPageType] - Cannot retrieve list of primary pages. \" + error_1);\r\n                        return [3 /*break*/, 3];\r\n                    case 3: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /* @ngInject */ DisplayConditionsFacade = __decorate([\r\n        SeDowngradeService(),\r\n        __metadata(\"design:paramtypes\", [IPageService,\r\n            PageRestrictionsService,\r\n            LogService])\r\n    ], /* @ngInject */ DisplayConditionsFacade);\r\n    return /* @ngInject */ DisplayConditionsFacade;\r\n}());\r\nexport { /* @ngInject */ DisplayConditionsFacade };\r\n//# sourceMappingURL=DisplayConditionsFacade.js.map","references":["/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-commons/dist/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts","/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/services/pageRestrictions/PageRestrictionsService.ts"],"map":"{\"version\":3,\"file\":\"DisplayConditionsFacade.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/facades/DisplayConditionsFacade.ts\"],\"names\":[],\"mappings\":\";AAAA;;GAEG;AACH,OAAO,EAAY,YAAY,EAAE,MAAM,YAAY,CAAC;AACpD,OAAO,EAIH,kBAAkB,EAClB,UAAU,EACb,MAAM,kBAAkB,CAAC;AAC1B,OAAO,EAAE,uBAAuB,EAAE,MAAM,sDAAsD,CAAC;AAsB/F;IACI,iDACY,WAAyB,EACzB,uBAAgD,EAChD,UAAsB;QAFtB,gBAAW,GAAX,WAAW,CAAc;QACzB,4BAAuB,GAAvB,uBAAuB,CAAyB;QAChD,eAAU,GAAV,UAAU,CAAY;IAC/B,CAAC;IAES,uEAAqB,GAAlC,UAAmC,MAAc;;;;;;wBACvC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;wBACnD,wBAAwB,GAAG,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;wBAE9C,qBAAM,OAAO,CAAC,GAAG,CAAC,CAAC,WAAW,EAAE,wBAAwB,CAAC,CAAC,EAAA;;wBAA9E,KAAoB,SAA0D,EAA7E,IAAI,QAAA,EAAE,SAAS,QAAA;wBAEtB,sBAAO;gCACH,QAAQ,EAAE,IAAI,CAAC,IAAI;gCACnB,QAAQ,EAAE,IAAI,CAAC,QAAQ;gCACvB,SAAS,WAAA;6BACZ,EAAC;;;;KACL;IAEY,yEAAuB,GAApC,UACI,aAAqB;;;;;;4BAEE,qBAAM,IAAI,CAAC,WAAW,CAAC,iBAAiB,CAAC,aAAa,CAAC,EAAA;;wBAAxE,cAAc,GAAG,SAAuD;wBAE9E,IAAI,cAAc,CAAC,MAAM,KAAK,CAAC,EAAE;4BAC7B,sBAAO,EAAE,EAAC;yBACb;wBAEyB,qBAAM,OAAO,CAAC,GAAG,CACvC,cAAc,CAAC,GAAG,CAAC,UAAC,aAAa;gCAC7B,OAAA,KAAI,CAAC,uBAAuB,CAAC,kCAAkC,CAAC,aAAa,CAAC,GAAG,CAAC;4BAAlF,CAAkF,CACrF,CACJ,EAAA;;wBAJK,iBAAiB,GAAG,SAIzB;wBAED,sBAAO,cAAc,CAAC,GAAG,CAAC,UAAC,aAAa,EAAE,KAAK,IAAK,OAAA,CAAC;gCACjD,QAAQ,EAAE,aAAa,CAAC,IAAI;gCAC5B,YAAY,EAAE,aAAa,CAAC,YAAY;gCACxC,YAAY,EAAE,iBAAiB,CAAC,KAAK,CAAC;6BACzC,CAAC,EAJkD,CAIlD,CAAC,EAAC;;;;KACP;IAEM,4DAAU,GAAjB,UAAkB,MAAc,EAAE,QAAkB;QAChD,OAAO,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;IAC7D,CAAC;IAEM,+DAAa,GAApB,UAAqB,MAAc;QAC/B,OAAO,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;IAClD,CAAC;IAEM,gFAA8B,GAArC,UACI,eAAuB;QAEvB,OAAO,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,UAAC,WAAqB,IAAK,OAAA,CAAC;YACrF,GAAG,EAAE,WAAW,CAAC,GAAG;YACpB,IAAI,EAAE,WAAW,CAAC,IAAI;YACtB,KAAK,EAAE,WAAW,CAAC,KAAK;SAC3B,CAAC,EAJsF,CAItF,CAAC,CAAC;IACR,CAAC;IAEY,4EAA0B,GAAvC,UACI,YAAoB,EACpB,SAAuB,EACvB,eAIC;;;;;;;wBAGgB,qBAAM,IAAI,CAAC,WAAW,CAAC,mCAAmC,CACnE,YAAY,EACZ,SAAS,EACT,eAAe,CAClB,EAAA;;wBAJK,IAAI,GAAG,SAIZ;wBAED,sBAAO;gCACH,UAAU,EAAE,IAAI,CAAC,UAAU;gCAC3B,OAAO,EAAE,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,UAAC,OAAO,IAAK,OAAA,CAAC;oCACrC,EAAE,EAAE,OAAO,CAAC,GAAG;oCACf,KAAK,EAAE,OAAO,CAAC,IAAI,IAAI,OAAO,CAAC,KAAK;iCACvC,CAAC,EAHsC,CAGtC,CAAC;6BACN,EAAC;;;wBAEF,IAAI,CAAC,UAAU,CAAC,IAAI,CAChB,2EAAyE,OAAO,CACnF,CAAC;;;;;;KAET;IAxFL;QADC,kBAAkB,EAAE;yCAGQ,YAAY;YACA,uBAAuB;YACpC,UAAU;+CAqFrC;IAAD,8CAAC;CAAA,AAzFD,IAyFC\"}","dts":{"name":"/Users/sandeepkalpane/Data/hybris2105/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/facades/DisplayConditionsFacade.d.ts","writeByteOrderMark":false,"text":"import { ICMSPage, IPageService } from 'cmscommons';\r\nimport { IUriContext, Page as SePage, SelectItem, LogService } from 'smarteditcommons';\r\nimport { PageRestrictionsService } from '../services/pageRestrictions/PageRestrictionsService';\r\nexport interface IDisplayConditionsPageVariation {\r\n    pageName: string;\r\n    creationDate: string | Date;\r\n    restrictions: number;\r\n}\r\nexport interface IDisplayConditionsPageInfo {\r\n    pageName: string;\r\n    pageType: string;\r\n    isPrimary: boolean;\r\n}\r\nexport interface IDisplayConditionsPrimaryPage {\r\n    uid: string;\r\n    uuid: string;\r\n    name: string;\r\n    label: string;\r\n}\r\nexport declare class DisplayConditionsFacade {\r\n    private pageService;\r\n    private pageRestrictionsService;\r\n    private logService;\r\n    constructor(pageService: IPageService, pageRestrictionsService: PageRestrictionsService, logService: LogService);\r\n    getPageInfoForPageUid(pageId: string): Promise<IDisplayConditionsPageInfo>;\r\n    getVariationsForPageUid(primaryPageId: string): Promise<IDisplayConditionsPageVariation[]>;\r\n    updatePage(pageId: string, pageData: ICMSPage): Promise<ICMSPage>;\r\n    isPagePrimary(pageId: string): Promise<boolean>;\r\n    getPrimaryPageForVariationPage(variationPageId: string): Promise<Partial<IDisplayConditionsPrimaryPage>>;\r\n    getPrimaryPagesForPageType(pageTypeCode: string, uriParams?: IUriContext, fetchPageParams?: {\r\n        search: string;\r\n        pageSize: number;\r\n        currentPage: number;\r\n    }): Promise<SePage<SelectItem>>;\r\n}\r\n"}}
